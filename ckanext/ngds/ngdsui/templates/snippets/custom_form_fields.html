{#
Adds a block of custom form fields.

extras - The fields to add.
errors - A dict of errors for the fields.
limit  - The total number of fields that should be output.
Example:

  {% snippet 'snippets/custom_form_fields.html', extras=data.extras, errors=errors, limit=3 %}

#}
{% import "macros/form.html" as form %}
{% macro is_selected(value,key,extra) %}
  {% for extra in extras %}
    {% if extra.key == key %}
      {% if extra.value == value %}
        selected
      {% endif %}
    {% endif %}
  {% endfor %}
{% endmacro %}

{% macro get_value(key,extra) -%}
  {% for extra in extras -%}
    {% if extra.key == key -%}
      {{ extra.value }}
    {%- endif %}
  {%- endfor %}
{%- endmacro %}


<div data-module="custom-fields">
  {#
  {# for extra in extras %}
    {% set prefix = 'extras__%d__' % loop.index0 %}
    {{ form.custom(
      names=(prefix ~ 'key', prefix ~ 'value', prefix ~ 'deleted'),
      id='field-extras-%d' % loop.index,
      label=_('Custom Field'),
      values=(extra.key, extra.value, extra.deleted),
      error=errors[prefix ~ 'key'] or errors[prefix ~ 'value']
    ) }}
  {% endfor #}

  {# Add a max of 3 empty columns #}
  {% set total_extras = extras|count %}
  {% set empty_extras = (limit or 3) - total_extras %}
  {% if empty_extras <= 0 %}{% set empty_extras = 1 %}{% endif %}

  {# for extra in range(total_extras, total_extras + empty_extras) %}
    {% set index = loop.index0 + (extras|count) %}
    {% set prefix = 'extras__%d__' % index %}
    {{ form.custom(
      names=(prefix ~ 'key', prefix ~ 'value', prefix ~ 'deleted'),
      id='field-extras-%d' % index,
      label=_('Custom Field'),
      values=(extra.key, extra.value, extra.deleted),
      error=errors[prefix ~ 'key'] or errors[prefix ~ 'value']
    ) }}
  {% endfor #}

<div class="control-group control-custom">
    <div class="controls editor">
      
    <div class="input-prepend">
      <input id="field-extras-1-key" name="extras__1__key" value="Category" placeholder="" style="display:none;">
      <label for="field-extras-1-value" class="control-label">Category</label>
      
      <select id="field-extras-1-value" name="extras__1__value" placeholder="">
          <option{{ is_selected("Dataset","Category",extras) }}>Dataset</option>
          <option{{ is_selected("Physical Collection","Category",extras) }}>Physical Collection</option>
          <option{{ is_selected("Catalog","Category",extras) }}>Catalog</option>
          <option{{ is_selected("Movie or Video","Category",extras) }}>Movie or Video</option>
          <option{{ is_selected("Drawing","Category",extras) }}>Drawing</option>
          <option{{ is_selected("Photograph","Category",extras) }}>Photograph</option>
          <option{{ is_selected("Remotely-Sensed Image","Category",extras) }}>Remotely-Sensed Image</option>
          <option{{ is_selected("Map","Category",extras) }}>Map</option>
          <option{{ is_selected("Text Document","Category",extras) }}>Text Document</option>
          <option{{ is_selected("Physical Artifact","Category",extras) }}>Physical Artifact</option>
          <option{{ is_selected("Desktop Application","Category",extras) }}>Desktop Application</option>
          <option{{ is_selected("Web Application","Category",extras) }}>Web Application</option>

      </select>
<!--   For removal? 
        <label class="checkbox" for="field-extras-1-remove">
          <input type="checkbox" id="field-extras-1-remove" name="extras__0__deleted"> <span>Remove</span>
        </label>
       -->
    </div>     
    </div>
  </div>
  
  <div class="control-group control-custom">
    <div class="controls editor">
      
    <div class="input-prepend">
      <input id="field-extras-2-key" name="extras__2__key" value="URI" placeholder="" style="display:none;">
      <label for="field-extras-2-value" class="control-label">URI</label>
      
      <input id="field-extras-2-value" type="text" name="extras__2__value" placeholder value="{{ get_value("URI",extras) }}">
      
<!--   For removal? 
        <label class="checkbox" for="field-extras-1-remove">
          <input type="checkbox" id="field-extras-1-remove" name="extras__0__deleted"> <span>Remove</span>
        </label>
       -->
    </div>     
    </div>
  </div>

  <div class="control-group control-custom">
    <div class="controls editor">
      
    <div class="input-prepend">
      <input id="field-extras-3-key" name="extras__3__key" value="Publication Date" placeholder="" style="display:none;">
      <label for="field-extras-3-value" class="control-label">Publication Date</label>
      
      <input id="field-extras-3-value" type="text" name="extras__3__value" value="{{ get_value("Publication Date",extras) }}" placeholder="">
      <script>
        $(document).ready(function() {
          $( "#field-extras-3-value" ).datepicker();
        });
      </script>
<!--   For removal? 
        <label class="checkbox" for="field-extras-1-remove">
          <input type="checkbox" id="field-extras-1-remove" name="extras__0__deleted"> <span>Remove</span>
        </label>
       -->
    </div>     
    </div>
  </div>

</div>

