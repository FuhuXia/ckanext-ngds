{% extends "page_ngds.html" %}
{% set active_page="library" %}
{% set default_group = h.get_default_group() %}

{#
	A list of variables we need in this page.
	* is_search_mode. Has there been a successful search, ie. has a query been received and are results to be expected.
#}

{% block content %}

<div id="library-container">
{% if g.central %}
<form action="{% url_for controller='package', action='search' %}" method="get"> 
{% else %}
<form action="{% url_for controller='organization', id=default_group , action='read' %}" method="get">   
  {% endif %}
  <div id="library-search-bar">
        
        
            <fieldset>
              <label >Search</label>
              <input type="text" class="search-browse-big-bar" name="q" value="{{ c.q }}" />
              <input type="submit" value="Go"/>
            </fieldset>
        
  </div>
  
  <div id="library-search-results">

    <div class="library-search-accordion">
      <ul class="accordion" id="search-accoridion">
 
         <!-- <img src="/assets/plus_grey.png" title="Expand All" id="expander-image"/>  -->
         
        {% set facet_list = h.get_ngdsfacets() %}
     
        {% for facet in facet_list %}
          <li>
            {% if c.group_dict.id %}
            {{ h.snippet('snippets/ngds_facets.html', facet=facet,topfacet=True,extras={'id':c.group_dict.id}) }}
            {% else %}
            {{ h.snippet('snippets/ngds_facets.html', facet=facet,topfacet=True) }}
            {% endif %}
          </li>
        {% endfor %}
      </ul>

    </div>      
    <div id="search-result-block">
      <div id="sort-save-bar">
          <div id="orderby-block">
            {{ h.snippet('snippets/sort_by.html', sort=c.sort_by_selected) }}
          </div>   
          <div id="date-filter">
              <label >Date Range:</label>
              <input type="text"  id="from-date"/>
              <label >to</label>
              <input type="text"  id="to-date"/>
              <input type="button" id="filter-pub-date" value="Go"/>
          </div>      
          <div id="save-block">
             <input type="button"  value="+ Save search"/>
          </div>             

      </div>

      <div class="search-results">


      <div class="search-results-container">
          <div class="search-item-image">
          </div>
          <div class="search-results-item no-border">
              <div id="search-text-block">
                <div id="search-text">
                    {% snippet 'snippets/search_result_text.html', query=c.q, count=c.page.item_count, type='dataset' %}
                </div>
              </div>
              {% if c.fields_grouped %}
              <div id="filter-block">
                  <div class="filter-list">
                    <label for="field-order-by">{{ _('Filtered by:') }}</label>
                    {% for field in c.fields_grouped %}
                      <span class="facet">{{ c.facet_titles.get(field) or h.get_field_title(field) }}:</span>
                      {% for value in c.fields_grouped[field] %}
                      <a href="{{ c.remove_field(field, value) }}" class="remove" title="{{ _('Remove') }}">
                        <span class="filtered pill">
                          {% if c.translated_fields and c.translated_fields.has_key((field,value)) %}
                            {{ c.translated_fields[(field,value)] }}
                          {% else %}
                            {{ value }}
                          {% endif %} <span class="close-button">X</span>
                        </span>
                        </a>
                      {% endfor %}
                    {% endfor %}
                  </div>
              </div>
              {% endif %}

          </div>

      </div>

          {% snippet 'snippets/search_results.html', packages=c.page.items %}
          <div id="pager">
          <div class="search-item-image valign-bottom">
            <div class="show-more">show more results</div>           
          </div>
            <div class="pagination-container">
                    {{ c.page.pager(q=c.q) }}         
            </div>
          </div>
      </div>
    </div>

</div>
</form>

</div>



<script type="text/javascript" src="/scripts/library/library.js"></script>

{% endblock %}