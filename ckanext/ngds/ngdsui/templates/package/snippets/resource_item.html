{# ___NGDS_HEADER_BEGIN___

National Geothermal Data System - NGDS
https://github.com/ngds

File: <filename>

Copyright (c) 2013, Siemens Corporate Technology and Arizona Geological Survey

Please Refer to the README.txt file in the base directory of the NGDS
project:
https://github.com/ngds/ckanext-ngds/README.txt

___NGDS_HEADER_END___ #}

{% set url = h.url_for(controller='package', action='resource_read', id=pkg.name, resource_id=res.id) %}

{% if pkg.resources and g.central %}
<li class="resource-item">
  {% block resource_item_title_central %}
  <a class="heading" href="{{ url }}" title="{{ res.name or res.description }}">
    {{ h.resource_display_name(res) | truncate(50) }}<span class="format-label" property="dc:format" data-format="{{ res.format.lower() or 'data' }}">{{ res.format }}</span>
    {{ h.popular('views', res.tracking_summary.total, min=10) }}
  </a>
  {% endblock %}
  <p class="description">
    {% if res.description %}
      {{ h.markdown_extract(res.description, extract_length=80) }}
    {% else %}
      <span class="empty">{{ _('No description for this resource') }}</span>
    {% endif %}
  </p>

  {% block resource_item_explore_central %}
  <div class="btn-group">
    <a href="{{url}}" class="btn btn-primary"><i class="icon-bar-chart"></i>Preview</a>
    {% if res.protocol and res.protocol.lower() == ('ogc:wms') %}
      {% set prospector_url = h.geo_prospector(res.url, res.layer, 'wms') %}
      <a href="{{ res.url }}" class="btn btn-primary" target="_blank"><i class="icon-info-sign"></i>{{ _('GetCapabilities') }}</a>
      {% if not prospector_url.wms == 'undefined' %}
        <a href="{{ prospector_url.wms }}" class="btn btn-primary" style="margin-left:10px;" target="_blank"><i class="icon-circle-arrow-right"></i>{{ _('Geothermal Prospector') }}</a>
      {% endif %}
    {% elif res.protocol and res.protocol.lower() == ('ogc:wfs') %}
      {% set prospector_url = h.geo_prospector(res.url, res.layer, 'wfs') %}
      <a href="{{ res.url }}" class="btn btn-primary" target="_blank"><i class="icon-info-sign"></i>{{ _('GetCapabilities') }}</a>
      {% if not prospector_url.wfs == 'undefined' %}
        <a href="{{ prospector_url.wfs }}" class="btn btn-primary" style="margin-left:10px;" target="_blank"><i class="icon-circle-arrow-right"></i>{{ _('Geothermal Prospector') }}</a>
      {% endif %}
    {% else %}
      <a href="{{ res.url }}" class="btn btn-primary" target="_blank"><i class="icon-download"></i>{{ _('Download') }}</a>
    {% endif %}
    <ul class="dropdown-menu">
      {% block resource_item_explore_links_central %}
      <li>
        <a href="{{ url }}"><i class="icon-bar-chart"></i>{{ _('Preview') }}</a>
      </li>
      <li>
        <a href="{{ res.url }}" class="resource-url-analytics" target="_blank"><i class="icon-download"></i>{{ _('Download') }}</a>
      </li>
      {% endblock %}
    </ul>
  </div>
  {% endblock %}
</li>

{% elif g.node_in_a_box and pkg.resources and not res.format.lower() == 'csv' or res.format.lower() == 'csv' and h.check_datastore(res.id) %}
<li class="resource-item">
  {% block resource_item_title %}
  <a class="heading" href="{{ url }}" title="{{ res.name or res.description }}">
    {{ h.resource_display_name(res) | truncate(50) }}<span class="format-label" property="dc:format" data-format="{{ res.format.lower() or 'data' }}">{{ res.format }}</span>
    {{ h.popular('views', res.tracking_summary.total, min=10) }}
  </a>
  {% endblock %}
  <p class="description">
    {% if res.description %}
      {{ h.markdown_extract(res.description, extract_length=80) }}
    {% else %}
      <span class="empty">{{ _('No description for this resource') }}</span>
    {% endif %}
  </p>

  {% block resource_item_explore %}
  <div class="btn-group">
    <a href="{{url}}" class="btn btn-primary"><i class="icon-bar-chart"></i>Preview</a>
    {% if res.protocol and res.protocol.lower() == ('ogc:wms') %}
      {% set prospector_url = h.geo_prospector(res.url, res.layer, 'wms') %}
      <a href="{{ res.url }}" class="btn btn-primary" target="_blank"><i class="icon-info-sign"></i>{{ _('GetCapabilities') }}</a>
      {% if not prospector_url.wms == 'undefined' %}
        <a href="{{ prospector_url.wms }}" class="btn btn-primary" style="margin-left:10px;" target="_blank"><i class="icon-circle-arrow-right"></i>{{ _('Geothermal Prospector') }}</a>
      {% endif %}
    {% elif res.protocol and res.protocol.lower() == ('ogc:wfs') %}
      {% set prospector_url = h.geo_prospector(res.url, res.layer, 'wfs') %}
      <a href="{{ res.url }}" class="btn btn-primary" target="_blank"><i class="icon-info-sign"></i>{{ _('GetCapabilities') }}</a>
      {% if not prospector_url.wfs == 'undefined' %}
        <a href="{{ prospector_url.wfs }}" class="btn btn-primary" style="margin-left:10px;" target="_blank"><i class="icon-circle-arrow-right"></i>{{ _('Geothermal Prospector') }}</a>
      {% endif %}
    {% else %}
      <a href="{{ res.url }}" class="btn btn-primary" target="_blank"><i class="icon-download"></i>{{ _('Download') }}</a>
    {% endif %}
    {% if h.check_access('package_create') and not g.central %}
    {% if h.is_plugin_enabled('geoserver') %}
      {% if h.is_ogc_publishable(res.id) %}
        {% if h.is_spatialized(res)==True %}
         <button class="btn btn-primary unspatialize" style="margin-left:10px;" data-ogc-unpublish data-ogc-resource="{{res.id}}" data-ogc-layer="{{res.layer_name}}" value="{{ res.id }},{{ res.layer_name }}">{{ _('Unpublish OGC') }}</button>
        {% else %}
          {% if res.content_model_uri and res.content_model_version and not res.content_model_layer == 'None' %}
            <button class="btn btn-primary spatialize" style="margin-left:10px;" data-ogc-publish data-ogc-resource="{{res.id}}" data-ogc-collection="{{pkg.id}}" data-ogc-layer="{{res.content_model_layer}}" value="{{ res.id }},{{ pkg.id }}">{{ _('Publish OGC') }}</button>
          {% else %}
            <button class="btn btn-primary spatialize" style="margin-left:10px;" data-ogc-publish data-ogc-resource="{{res.id}}" data-ogc-collection="{{pkg.id}}" value="{{ res.id }},{{ pkg.id }}">{{ _('Publish OGC') }}</button>
          {% endif %}
        {% endif %}
      {% endif %}
    {% endif %}

    {% endif %}
  </div>
  {% endblock %}
</li>

{% elif g.node_in_a_box and pkg.resources and res.format.lower() == 'csv' and not h.check_datastore(res.id) %}
<li class="malformed-resource-item">
  {% block malformed_resource_item_title %}
  <div class="heading" href="{{ url }}" title="{{ res.name or res.description }}">
    <span class="format-label" property="dc:format" data-format="{{ res.format.lower() or 'data' }}">{{ res.format }}</span>
    <div class="error-heading">
      <div class="error-heading-text">ERROR PROCESSING FILE: {{ h.resource_display_name(res) | truncate(50) }}</div>
    </div>
    <div class="btn-group">
      <button type="button" class="btn btn-danger" data-toggle="collapse" data-target="#error-details">Details</button>
    </div>
    <div id="error-details" class="collapse">
      <h5>Your CSV file is unable to be processed</h5>
      <section>
        <h5>Here's what this means:</h5>
          <ul>
            <li>
              You won't be able to access, download, preview, publish or interact with this dataset in any other way.
            </li>
          </ul>
      </section>
      <section>
        <h5>Here's why this might have happened:</h5>
          <ul>
            <li>
              Malformation: This software expects CSV files to have proper form.  Things like trailing commas, trailing spaces and illegal characters can result in a malformed file error.  Malformed files do not get indexed into the system.
            </li>
            <li>
              File Size:  CSV files larger than 50 MB cannot be processed and will not be indexed into the system.
            </li>
          </ul>
      </section>
      <section>
        <h5>Here's what you can do about it:</h5>
          <ul>
            <li>
              Go the dataset edit page and remove this CSV resource from your package.  Upload it again when it has been fixed.
            </li>
          </ul>
      </section>
    </div>
  </div>
  {% endblock %}
</li>
{% endif %}