<script>
{% if data %}
    form_type_v = "{{data['form_type']}}";
    resource_location = window.location.origin+"{{data['resource_location']}}";
{% else %}
  form_type_v = '';
{% endif %}
</script>
<form id="file-upload-form" action="/ngds/contribute/upload_file" method="post" enctype="multipart/form-data">
  <div id="file-upload" style="display:none;">
          <input type="submit" name="file-upload-button" value="Upload"></input>
          <input type="file" id="file" name="file" class="structured-input"></input>
          {% if data['key'] %}
          <input type="hidden" name="key" id="key1" value="{{data['key']}}"></input>
          {% else %}
          <input type="hidden" name="key" id="key1"></input>
          {% endif %}
          <input type="hidden" name="dataset_name" value="{{pkg_name}}"/>
          <input type="hidden" name="form-type" id="form_type"/>
  </div>
</form>

<form class="dataset-form dataset-resource-form form-horizontal" action="/ngds/contribute/create_or_update_resource" method="post" data-module="resource-form basic-form">
  <ol class="stages stage-2">
    <li class="first-stage complete">
        <button class="highlight" name="save" value="go-dataset" type="submit">1. Create dataset</button>
    </li>
    <li class="middle-stage active">
        <span class="highlight">2. Add Resources</span>
    </li>
    <li class="last-stage uncomplete">
        <span class="highlight">3. Dataset Metadata</span>
    </li>
  </ol>

  <div class="main-controls">
      <div class="radio-section">
        <input type="hidden" name="dataset_name" value="{{pkg_name}}"/>
        <input type="radio" id="upload-type-selection" name="upload_type_selection" value="upload_type"/>
        <label for="upload-type-selection">Upload a file</label><br/>
        &nbsp;&nbsp;&nbsp;&nbsp;<input type="radio" id="upload-type-structured" class="upload-type" name="upload-type" value="structured"/>
        <label for="upload-type-structured" id="upload-type-structured-label">Structured</label><br/>
        &nbsp;&nbsp;&nbsp;&nbsp;<input type="radio" id="upload-type-unstructured" class="upload-type" name="upload-type" value="unstructured"/>
        <label for="upload-type-unstructured" id="upload-type-unstructured-label">Unstructured</label>
      </div>

      <div class="radio-section">
        <input type="radio" id="data-service" name="upload-type" value="data-service" />
        <label for="data-service">Link to a data service</label>
      </div>

      <div class="radio-section">
        <input type="radio" id="offline-resouece" name="upload-type" value="offline-resource" />
        <label for="offline-resource">Offline resource</label>
      </div>
  </div>

  <div class="form-body">
   <!-- Offline Resource End -->

   <!-- <div class="input-group">
        <div class="sp-label"><label>Distributor</label></div>
        <input type="text" name="distributor" id="structured_distributor" class="structured-input"></input>
      </div> -->

  </div>
  <div class="form-actions">
        <button type="submit" name="save" value="go-dataset">Previous Page</button>
        <button type="submit" name="save" value="go-dataset">Save and Add Another</button>
        <button type="submit" name="save" value="go-metadata">Additional Metadata</button>
    </div>
</form>

{% raw %}
<script>
var structured_form = {
  'form':[
    {
      'label':'Resource URL',
      'name':'url',
      'tag':'input',
      'additional':function() {
        return 'type=text id=url';
      }
    },
    {
      'label':'Name',
      'name':'name',
      'tag':'input',
      'additional':function() {
        return 'type=text';
      }
    },
    {
      'label':'Content Model',
      'name':'content_model',
      'tag':'select',
      'id':function() {
        return 'id=content_model';
      }
    },
    {
      'label':'Description',
      'name':'description',
      'tag':'textarea',
      'id':function() {
        return 'id=description';
      },
      'additional':function() {
        return 'rows=4 cols=1'
      },
      'classes':function() {
        return 'description-label-div';
      }
    },
    {
      'label':'Distributor',
      'name':'distributor',
      'tag':'input',
      'additional':function() {
        return 'type=text';
      }
    },
    {
    'label':'Format',
    'name':'format',
    'tag':'input',
    'additional':function() {
      return 'type=text';
      }
    }
  ]
};




var position_file_uploader = function(selector) {
  var ref = $(selector);
  var file_upload = $("#file-upload");
  file_upload.css("position","absolute");
  file_upload.css("left",ref.position().left+ref.width()+10);
  file_upload.css("top",ref.position().top);
  file_upload.show();
};

var structured_form_template = "{{#form}}\
        <div class=\"input-group\">\
            <div class=\"sp-label {{classes}}\"><label>{{label}}</label></div>\
            <{{tag}} {{additional}} name=\"{{name}}\" {{id}} class=\"structured-input\">{{inner}}</{{tag}}>\
        </div>\
{{/form}}";

$('input[name="upload-type"]').on('change',function(ev){
  
  var value = ev.target.value;

  $(".form-body").empty();

  if(value==="structured") {
    console.log(Mustache.render(structured_form_template,structured_form));
    $(".form-body").html(Mustache.render(structured_form_template,structured_form));
    position_file_uploader("#url");
    populate_content_models("#content_model");
  }

});


</script>
{% endraw %}

<script type="text/javascript" src="/scripts/contribute/resource_form.js"></script>