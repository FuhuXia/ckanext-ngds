/* Copyright (c) 2014, Siemens Corporate Technology and Arizona Geological Survey */
/* Copyright (c) 2014, Siemens Corporate Technology and Arizona Geological Survey */
/* Copyright (c) 2014, Siemens Corporate Technology and Arizona Geological Survey */
$(document).ready(function(){(function b(){ngds.util.state.prev_resource_type=$("[name=resource_format]:checked").val();ngds.util.state.versions={};ngds.util.state.versions_dom={};if($("[name=content_model_version]").length>0&&$("[name=content_model_version]").parent().parent().attr("class").indexOf("error")!==-1){$("[name=content_model_version]").prop("selectedIndex",-1)}ngds.util.state["first-load"]=true})();(function a(){ngds.memorizer=(function(){var f={};var d=function(i,g,h){if(typeof f[i]==="undefined"){f[i]={}}f[i][g]=h};var e=function(h,g){if(typeof f[h]==="undefined"){return""}if(typeof f[h][g]==="undefined"){return""}return f[h][g]};return{memorize:d,remind:e}})()})();ngds.memorize_additional_fields=function(d){$(".additional-resource-fields input").each(function(){if($(this).attr("class")==="select2-input"){return}if($(this).attr("data-module")==="autocomplete"){var e=$(this).attr("name");var f=$(this).select2("data");ngds.memorizer.memorize(d,e,f)}else{if($(this).val()!==""){var e=$(this).attr("name");var f=$(this).val();ngds.memorizer.memorize(d,e,f)}}});$(".additional-resource-fields select").each(function(){if($(this).val()!==""){if($(this).attr("data-module")==="autocomplete"){var e=$(this).attr("name");var f=$(this).select2("data");ngds.memorizer.memorize(d,e,f)}else{var e=$(this).attr("name");var f=$(this).val();ngds.memorizer.memorize(d,e,f)}}});$(".additional-resource-fields textarea").each(function(){if($(this).val()!==""){var e=$(this).attr("name");var f=$(this).val();ngds.memorizer.memorize(d,e,f)}})};ngds.restore_additional_fields=function(d){$(".additional-resource-fields input").each(function(){if($(this).attr("class")==="select2-input"){return}var e=$(this).attr("name");var f=ngds.memorizer.remind(d,e);if(f!==""){if(typeof f==="object"){$(this).val(JSON.stringify(f))}if($(this).attr("data-module")==="autocomplete"){$(this).select2("data",f)}else{$(this).val(f)}}});$(".additional-resource-fields textarea").each(function(){var e=$(this).attr("name");var f=ngds.memorizer.remind(d,e);if(f!==""){$(this).val(f)}});$(".additional-resource-fields select").each(function(){var f=$(this).attr("name");var g=ngds.memorizer.remind(d,f);if(g===""){return}var e=$(this).children().filter("option");if($(this).attr("data-module")==="autocomplete"){$(this).select2("data",g)}else{e.each(function(){if($(this).val()===g){$(this).prop("selected",true)}})}})};$("[data-module=resource-upload-field] label").click(function(e){var f=$(e.currentTarget).attr("for");if(f!=="field-resource-type-upload"){var d=$("#"+$(e.currentTarget).attr("for")).val();ngds.memorize_additional_fields(ngds.util.state.prev_resource_type);ngds.util.state.prev_resource_type=d;ngds.resource_type_change(d)}});ngds.load_content_model_widget=function(d){ngds.initialize_content_model_widget(function(){if(typeof $("#field-content-model")[0]!=="undefined"){ckan.module.initializeElement($("#field-content-model")[0])}if(typeof $("[name=content_model_uri]").val()!=="undefined"&&$("[name=content_model_uri]").val()!=="None"){var h=$("[name=content_model_uri]").val();var g=ngds.util.state.versions_dom[h];if(typeof g!=="undefined"){$("[name=content_model_version]").empty();for(var e=0;e<g.length;e++){$("[name=content_model_version]").append(g[e])}}}function f(k){$("#field-content-model-version").select2("destroy");var n=k;var l=function(i){var o={tag:"option",attributes:{value:i.uri,text:i.version}};return ngds.util.dom_element_constructor(o)};if(typeof ngds.util.state.versions[n]==="undefined"){$.ajax({url:"/api/action/get_content_model_version_for_uri",data:JSON.stringify({cm_uri:n}),type:"POST",success:function(p){var o=p.result;ngds.util.state.versions[n]=o;var r=ngds.util.state.versions_dom[n]=[];$("[name=content_model_version]").empty();for(var q=0;q<o.length;q++){$("[name=content_model_version]").append(l(o[q]));r.push(l(o[q]))}if(ngds.memorizer.remind("structured","content_model_version")!==""){$("#field-content-model-version option").filter("[value="+ngds.memorizer.remind("structured","content_model_version")["id"]+"]").prop("selected",true)}else{}$("#field-content-model-version").select2()}})}else{var m=ngds.util.state.versions_dom[n];$("[name=content_model_version]").empty();for(var j=0;j<m.length;j++){$("[name=content_model_version]").append(m[j])}}}$("[name=content_model_uri]").on("change",function(i){var j=i.val;console.log(j);if(j==="None"||j==="none"){$("[name=content_model_version]").select2("destroy");$("[name=content_model_version]").empty();$("[name=content_model_version]").select2();return}f(j)});ngds.restore_additional_fields(d);if($("[name=content_model_uri]").length>0&&$("[name=content_model_uri]").val()!=="None"&&$("[name=content_model_uri]").val()!=="none"){f($("[name=content_model_uri]").val())}});$("[name=content_model_version]").select2();if(d===undefined){$(".resource-upload-field").css("display","none")}ngds.setup_responsible_party()};ngds.resource_type_change=function(d){$(".additional-resource-fields").empty();construct_form_objects();if(d==="structured"){$(".additional-resource-fields").replaceWith(ngds.forms.structured_form.form);ngds.load_content_model_widget("structured");ckan.module.initializeElement($("#field-distributor")[0]);ckan.module.initializeElement($("#field-format")[0]);$(".resource-upload-field").css("display","inline-block")}if(d==="unstructured"){$(".additional-resource-fields").replaceWith(ngds.forms.unstructured_form.form);ckan.module.initializeElement($("#field-distributor")[0]);ckan.module.initializeElement($("#field-format")[0]);$(".resource-upload-field").css("display","inline-block")}if(d==="offline-resource"){$(".additional-resource-fields").replaceWith(ngds.forms.offline_form.form);ckan.module.initializeElement($("#field-distributor")[0]);$(".resource-upload-field").css("display","none")}if(d==="data-service"){$(".additional-resource-fields").replaceWith(ngds.forms.data_service_form.form);ckan.module.initializeElement($("#field-distributor")[0]);ckan.module.initializeElement($("#field-protocol")[0]);$(".resource-upload-field").css("display","none")}ngds.setup_responsible_party();ngds.restore_additional_fields(d)};var c;ngds.setup_responsible_party=function(){if($("#field-distributor").length){try{$("#field-distributor").off("change",ngds.distributor_on_change)}catch(d){}$("#field-distributor").on("change",ngds.distributor_on_change);if(!c){c=setInterval(ngds.override_distrib_initSelection,10)}}};ngds.distributor_on_change=function(f){try{$.parseJSON(f.val)}catch(d){ngds.responsible_parties.add_new("Add New Distributor","#field-distributor",f.val)}};ngds.override_distrib_initSelection=function(){if($("#field-distributor").data("select2")&&$("#field-distributor").data("select2").opts){clearInterval(c);c=undefined;ngds.responsible_parties.overrideInitSelection("#field-distributor");$("#field-distributor").trigger("change")}};ngds.load_content_model_widget($("[name=resource_format]:checked").val())});ngds.initialize_content_model_widget=function(c){if(typeof ngds.util.state.content_models==="undefined"){$.ajax({url:"/api/action/get_content_models_for_ui",type:"POST",data:JSON.stringify({dummy:"dummy"}),success:function(f){ngds.util.state.content_models=f.result;var j=function(k){var i={tag:"option",attributes:{value:k.uri,text:k.title}};return ngds.util.dom_element_constructor(i)};var d=ngds.util.state.content_models;var e=ngds.util.state.content_models_dom=[];var h=j({uri:"None",title:"none"});$("[name=content_model_uri]").append(h);e.push(h);for(var g=0;g<d.length;g++){$("[name=content_model_uri]").append(j(d[g]));e.push(j(d[g]))}c()}})}else{var a=ngds.util.state.content_models_dom;for(var b=0;b<a.length;b++){$("[name=content_model_uri]").append(a[b])}c()}};function construct_form_objects(){ngds.forms={};ngds.forms.structured_form={};ngds.forms.unstructured_form={};ngds.forms.offline_form={};ngds.forms.data_service_form={};ngds.forms.structured_form.form=ngds.util.dom_element_constructor(structured_form_raw);ngds.forms.unstructured_form.form=ngds.util.dom_element_constructor(unstructured_form_raw);ngds.forms.offline_form.form=ngds.util.dom_element_constructor(offline_form_raw);ngds.forms.data_service_form.form=ngds.util.dom_element_constructor(data_service_raw)}var structured_form_raw={tag:"div",attributes:{"class":"additional-resource-fields"},children:[{tag:"div",attributes:{"class":"control-group control-full"},children:[{tag:"label",attributes:{"class":"control-label","for":"field-content-model",text:"Content Model"}},{tag:"div",attributes:{"class":"controls"},children:[{tag:"select",attributes:{id:"field-content-model",type:"text",name:"content_model_uri",placeholder:"Ex: Borehole Lithology Intercepts","data-module":"autocomplete"}}]}]},{tag:"div",attributes:{"class":"control-group control-full"},children:[{tag:"label",attributes:{"class":"control-label","for":"field-content-model-version",text:"Content Model Version"}},{tag:"div",attributes:{"class":"controls"},children:[{tag:"select",attributes:{id:"field-content-model-version",type:"text",name:"content_model_version",placeholder:"Ex: 1.1",}}]}]},{tag:"div",attributes:{"class":"control-group control-full"},children:[{tag:"label",attributes:{"class":"control-label","for":"field-distributor",text:"Distributor"}},{tag:"div",attributes:{"class":"controls"},children:[{tag:"input",attributes:{id:"field-distributor",type:"text",name:"distributor",placeholder:"Ex: John Doe","data-module-label":"name","data-module":"autocomplete","data-module-source":"responsible_parties?q=?","data-module-key":"value"}}]}]},{tag:"div",attributes:{"class":"control-group control-full"},children:[{tag:"label",attributes:{"class":"control-label","for":"field-format",text:"Format"}},{tag:"div",attributes:{"class":"controls"},children:[{tag:"input",attributes:{id:"field-format",type:"text",name:"format",placeholder:"eg. CSV, XML or JSON","data-module":"autocomplete","data-module-source":"/api/2/util/resource/format_autocomplete?incomplete=?"}}]}]}]};var data_service_raw={tag:"div",attributes:{"class":"additional-resource-fields"},children:[{tag:"div",attributes:{"class":"control-group control-full"},children:[{tag:"label",attributes:{"class":"control-label","for":"field-distributor",text:"Distributor"}},{tag:"div",attributes:{"class":"controls"},children:[{tag:"input",attributes:{id:"field-distributor",type:"text",name:"distributor",placeholder:"Ex: John Doe","data-module-label":"name","data-module":"autocomplete","data-module-source":"responsible_parties?q=?","data-module-key":"value"}}]}]},{tag:"div",attributes:{"class":"control-group control-medium"},children:[{tag:"label",attributes:{"class":"control-label","for":"field-protocol",text:"Protocol"}},{tag:"div",attributes:{"class":"controls"},children:[{tag:"select",attributes:{id:"field-protocol",name:"protocol",placeholder:"Ex: WMS","data-module":"autocomplete"},children:[{tag:"option",attributes:{text:"WMS",value:"OGC:WMS"}},{tag:"option",attributes:{text:"WFS",value:"OGC:WFS"}},{tag:"option",attributes:{text:"ESRI Map Service",value:"ESRI"}},{tag:"option",attributes:{text:"CSW",value:"OGC:CSW"}},{tag:"option",attributes:{text:"SOS",value:"OGC:SOS"}},{tag:"option",attributes:{text:"OPeNDAP",value:"OPeNDAP"}},{tag:"option",attributes:{text:"Other",value:"other"}}]}]}]},{tag:"div",attributes:{"class":"control-group control-full"},children:[{tag:"label",attributes:{"class":"control-label","for":"field-layer",text:"Layer"}},{tag:"div",attributes:{"class":"controls"},children:[{tag:"input",attributes:{type:"text",name:"layer",id:"field-layer",placeholder:"A layer name that can be used to access this resource using the protocol selected above. Eg. A Geoserver WMS layer."}}]}]}]};var unstructured_form_raw={tag:"div",attributes:{"class":"additional-resource-fields"},children:[{tag:"div",attributes:{"class":"control-group control-full"},children:[{tag:"label",attributes:{"class":"control-label","for":"field-distributor",text:"Distributor"}},{tag:"div",attributes:{"class":"controls"},children:[{tag:"input",attributes:{id:"field-distributor",type:"text",name:"distributor",placeholder:"Ex: John Doe","data-module-label":"name","data-module":"autocomplete","data-module-source":"responsible_parties?q=?","data-module-key":"value"}}]}]},{tag:"div",attributes:{"class":"control-group control-full"},children:[{tag:"label",attributes:{"class":"control-label","for":"field-format",text:"Format"}},{tag:"div",attributes:{"class":"controls"},children:[{tag:"input",attributes:{id:"field-format",type:"text",name:"format",placeholder:"eg. CSV, XML or JSON","data-module":"autocomplete","data-module-source":"/api/2/util/resource/format_autocomplete?incomplete=?"}}]}]}]};var offline_form_raw={tag:"div",attributes:{"class":"additional-resource-fields"},children:[{tag:"div",attributes:{"class":"control-group control-full"},children:[{tag:"label",attributes:{"class":"control-label","for":"field-distributor",text:"Distributor"}},{tag:"div",attributes:{"class":"controls"},children:[{tag:"input",attributes:{id:"field-distributor",type:"text",name:"distributor",placeholder:"Ex: John Doe","data-module-label":"name","data-module":"autocomplete","data-module-source":"responsible_parties?q=?","data-module-key":"value"}}]},{tag:"label",attributes:{"class":"control-label","for":"field-ordering-procedure",text:"Ordering Procedure"}},{tag:"div",attributes:{"class":"controls editor"},children:[{tag:"textarea",attributes:{id:"field-ordering-procedure",name:"ordering_procedure",placeholder:"Indicate how a person can go about obtaining this resource.",cols:"20",rows:"5"}}]}]}]};
