$(document).ready(function(){(function b(){ngds.util.state.prev_resource_type=$("[name=resource_format]:checked").val();ngds.util.state.versions={};ngds.util.state.versions_dom={};if($("[name=content_model_version]").length>0&&$("[name=content_model_version]").parent().parent().attr("class").indexOf("error")!==-1){$("[name=content_model_version]").prop("selectedIndex",-1)}ngds.util.state["first-load"]=true})();(function a(){ngds.memorizer=(function(){var e={};var c=function(h,f,g){if(typeof e[h]==="undefined"){e[h]={}}e[h][f]=g};var d=function(g,f){if(typeof e[g]==="undefined"){return""}if(typeof e[g][f]==="undefined"){return""}return e[g][f]};return{memorize:c,remind:d}})()})();ngds.memorize_additional_fields=function(c){$(".additional-resource-fields input").each(function(){if($(this).attr("class")==="select2-input"){return}if($(this).attr("data-module")==="autocomplete"){var d=$(this).attr("name");var e=$(this).select2("data");ngds.memorizer.memorize(c,d,e)}else{if($(this).val()!==""){var d=$(this).attr("name");var e=$(this).val();ngds.memorizer.memorize(c,d,e)}}});$(".additional-resource-fields select").each(function(){if($(this).val()!==""){if($(this).attr("data-module")==="autocomplete"){var d=$(this).attr("name");var e=$(this).select2("data");ngds.memorizer.memorize(c,d,e)}else{var d=$(this).attr("name");var e=$(this).val();ngds.memorizer.memorize(c,d,e)}}});$(".additional-resource-fields textarea").each(function(){if($(this).val()!==""){var d=$(this).attr("name");var e=$(this).val();ngds.memorizer.memorize(c,d,e)}})};ngds.restore_additional_fields=function(c){$(".additional-resource-fields input").each(function(){if($(this).attr("class")==="select2-input"){return}var d=$(this).attr("name");var e=ngds.memorizer.remind(c,d);if(e!==""){if(typeof e==="object"){$(this).val(JSON.stringify(e))}if($(this).attr("data-module")==="autocomplete"){$(this).select2("data",e)}else{$(this).val(e)}}});$(".additional-resource-fields textarea").each(function(){var d=$(this).attr("name");var e=ngds.memorizer.remind(c,d);if(e!==""){$(this).val(e)}});$(".additional-resource-fields select").each(function(){var e=$(this).attr("name");var f=ngds.memorizer.remind(c,e);if(f===""){return}var d=$(this).children().filter("option");if($(this).attr("data-module")==="autocomplete"){$(this).select2("data",f)}else{d.each(function(){if($(this).val()===f){$(this).prop("selected",true)}})}})};$("[data-module=resource-upload-field] label").click(function(d){var e=$(d.currentTarget).attr("for");if(e!=="field-resource-type-upload"){var c=$("#"+$(d.currentTarget).attr("for")).val();ngds.memorize_additional_fields(ngds.util.state.prev_resource_type);ngds.util.state.prev_resource_type=c;ngds.resource_type_change(c)}});ngds.load_content_model_widget=function(c){ngds.initialize_content_model_widget(function(){if(typeof $("#field-content-model")[0]!=="undefined"){ckan.module.initializeElement($("#field-content-model")[0])}if(typeof $("[name=content_model_uri]").val()!=="undefined"&&$("[name=content_model_uri]").val()!=="None"){var g=$("[name=content_model_uri]").val();var f=ngds.util.state.versions_dom[g];if(typeof f!=="undefined"){$("[name=content_model_version]").empty();for(var d=0;d<f.length;d++){$("[name=content_model_version]").append(f[d])}}}function e(j){$("#field-content-model-version").select2("destroy");var m=j;var k=function(i){var n={tag:"option",attributes:{value:i.uri,text:i.version}};return ngds.util.dom_element_constructor(n)};if(typeof ngds.util.state.versions[m]==="undefined"){$.ajax({url:"/api/action/get_content_model_version_for_uri",data:JSON.stringify({cm_uri:m}),type:"POST",success:function(o){var n=o.result;ngds.util.state.versions[m]=n;var q=ngds.util.state.versions_dom[m]=[];$("[name=content_model_version]").empty();for(var p=0;p<n.length;p++){$("[name=content_model_version]").append(k(n[p]));q.push(k(n[p]))}if(ngds.memorizer.remind("structured","content_model_version")!==""){$("#field-content-model-version option").filter("[value="+ngds.memorizer.remind("structured","content_model_version")["id"]+"]").prop("selected",true)}else{}$("#field-content-model-version").select2()}})}else{var l=ngds.util.state.versions_dom[m];$("[name=content_model_version]").empty();for(var h=0;h<l.length;h++){$("[name=content_model_version]").append(l[h])}}}$("[name=content_model_uri]").on("change",function(h){console.log("here");var i=h.val;console.log(i);if(i==="None"||i==="none"){$("[name=content_model_version]").select2("destroy");$("[name=content_model_version]").empty();$("[name=content_model_version]").select2();return}e(i)});ngds.restore_additional_fields(c);if($("[name=content_model_uri]").length>0&&$("[name=content_model_uri]").val()!=="None"&&$("[name=content_model_uri]").val()!=="none"){e($("[name=content_model_uri]").val())}});$("[name=content_model_version]").select2()};ngds.resource_type_change=function(c){$(".additional-resource-fields").empty();construct_form_objects();if(c==="structured"){$(".additional-resource-fields").replaceWith(ngds.forms.structured_form.form);ngds.load_content_model_widget("structured");ckan.module.initializeElement($("#field-distributor")[0]);ckan.module.initializeElement($("#field-format")[0])}if(c==="unstructured"){$(".additional-resource-fields").replaceWith(ngds.forms.unstructured_form.form);ckan.module.initializeElement($("#field-distributor")[0]);ckan.module.initializeElement($("#field-format")[0])}if(c==="offline-resource"){$(".additional-resource-fields").replaceWith(ngds.forms.offline_form.form)}if(c==="data-service"){$(".additional-resource-fields").replaceWith(ngds.forms.data_service_form.form);ckan.module.initializeElement($("#field-distributor")[0]);ckan.module.initializeElement($("#field-protocol")[0])}ngds.restore_additional_fields(c)};ngds.load_content_model_widget($("[name=resource_format]:checked").val())});ngds.initialize_content_model_widget=function(c){if(typeof ngds.util.state.content_models==="undefined"){$.ajax({url:"/api/action/get_content_models_for_ui",type:"POST",data:JSON.stringify({dummy:"dummy"}),success:function(f){ngds.util.state.content_models=f.result;var j=function(k){var i={tag:"option",attributes:{value:k.uri,text:k.title}};return ngds.util.dom_element_constructor(i)};var d=ngds.util.state.content_models;var e=ngds.util.state.content_models_dom=[];var h=j({uri:"None",title:"none"});$("[name=content_model_uri]").append(h);e.push(h);for(var g=0;g<d.length;g++){$("[name=content_model_uri]").append(j(d[g]));e.push(j(d[g]))}c()}})}else{var a=ngds.util.state.content_models_dom;for(var b=0;b<a.length;b++){$("[name=content_model_uri]").append(a[b])}c()}};function construct_form_objects(){ngds.forms={};ngds.forms.structured_form={};ngds.forms.unstructured_form={};ngds.forms.offline_form={};ngds.forms.data_service_form={};ngds.forms.structured_form.form=ngds.util.dom_element_constructor(structured_form_raw);ngds.forms.unstructured_form.form=ngds.util.dom_element_constructor(unstructured_form_raw);ngds.forms.offline_form.form=ngds.util.dom_element_constructor(offline_form_raw);ngds.forms.data_service_form.form=ngds.util.dom_element_constructor(data_service_raw)}var structured_form_raw={tag:"div",attributes:{"class":"additional-resource-fields"},children:[{tag:"div",attributes:{"class":"control-group control-full"},children:[{tag:"label",attributes:{"class":"control-label","for":"field-content-model",text:"Content Model"}},{tag:"div",attributes:{"class":"controls"},children:[{tag:"select",attributes:{id:"field-content-model",type:"text",name:"content_model_uri",placeholder:"Ex: Borehole Lithology Intercepts","data-module":"autocomplete"}}]}]},{tag:"div",attributes:{"class":"control-group control-full"},children:[{tag:"label",attributes:{"class":"control-label","for":"field-content-model-version",text:"Content Model Version"}},{tag:"div",attributes:{"class":"controls"},children:[{tag:"select",attributes:{id:"field-content-model-version",type:"text",name:"content_model_version",placeholder:"Ex: 1.1",}}]}]},{tag:"div",attributes:{"class":"control-group control-full"},children:[{tag:"label",attributes:{"class":"control-label","for":"field-distributor",text:"Distributor"}},{tag:"div",attributes:{"class":"controls"},children:[{tag:"input",attributes:{id:"field-distributor",type:"text",name:"distributor",placeholder:"Ex: John Doe","data-module-label":"name","data-module":"autocomplete","data-module-source":"responsible_parties?q=?","data-module-key":"value"}}]}]},{tag:"div",attributes:{"class":"control-group control-full"},children:[{tag:"label",attributes:{"class":"control-label","for":"field-format",text:"Format"}},{tag:"div",attributes:{"class":"controls"},children:[{tag:"input",attributes:{id:"field-format",type:"text",name:"format",placeholder:"eg. CSV, XML or JSON","data-module":"autocomplete","data-module-source":"/api/2/util/resource/format_autocomplete?incomplete=?"}}]}]}]};var data_service_raw={tag:"div",attributes:{"class":"additional-resource-fields"},children:[{tag:"div",attributes:{"class":"control-group control-full"},children:[{tag:"label",attributes:{"class":"control-label","for":"field-distributor",text:"Distributor"}},{tag:"div",attributes:{"class":"controls"},children:[{tag:"input",attributes:{id:"field-distributor",type:"text",name:"distributor",placeholder:"Ex: John Doe","data-module-label":"name","data-module":"autocomplete","data-module-source":"responsible_parties?q=?","data-module-key":"value"}}]}]},{tag:"div",attributes:{"class":"control-group control-medium"},children:[{tag:"label",attributes:{"class":"control-label","for":"field-protocol",text:"Protocol"}},{tag:"div",attributes:{"class":"controls"},children:[{tag:"select",attributes:{id:"field-protocol",name:"protocol",placeholder:"Ex: WMS","data-module":"autocomplete"},children:[{tag:"option",attributes:{text:"WMS",value:"OGC:WMS"}},{tag:"option",attributes:{text:"WFS",value:"OGC:WFS"}},{tag:"option",attributes:{text:"ESRI Map Service",value:"esri_map_service"}},{tag:"option",attributes:{text:"CSW",value:"csw"}},{tag:"option",attributes:{text:"SOS",value:"sos"}},{tag:"option",attributes:{text:"Open DAP",value:"opendap"}},{tag:"option",attributes:{text:"Other",value:"other"}}]}]}]},{tag:"div",attributes:{"class":"control-group control-full"},children:[{tag:"label",attributes:{"class":"control-label","for":"field-layer",text:"Layer"}},{tag:"div",attributes:{"class":"controls"},children:[{tag:"input",attributes:{type:"text",name:"layer",id:"field-layer",placeholder:"A layer name that can be used to access this resource using the protocol selected above. Eg. A Geoserver WMS layer."}}]}]}]};var unstructured_form_raw={tag:"div",attributes:{"class":"additional-resource-fields"},children:[{tag:"div",attributes:{"class":"control-group control-full"},children:[{tag:"label",attributes:{"class":"control-label","for":"field-distributor",text:"Distributor"}},{tag:"div",attributes:{"class":"controls"},children:[{tag:"input",attributes:{id:"field-distributor",type:"text",name:"distributor",placeholder:"Ex: John Doe","data-module-label":"name","data-module":"autocomplete","data-module-source":"responsible_parties?q=?","data-module-key":"value"}}]}]},{tag:"div",attributes:{"class":"control-group control-full"},children:[{tag:"label",attributes:{"class":"control-label","for":"field-format",text:"Format"}},{tag:"div",attributes:{"class":"controls"},children:[{tag:"input",attributes:{id:"field-format",type:"text",name:"format",placeholder:"eg. CSV, XML or JSON","data-module":"autocomplete","data-module-source":"/api/2/util/resource/format_autocomplete?incomplete=?"}}]}]}]};var offline_form_raw={tag:"div",attributes:{"class":"additional-resource-fields"},children:[{tag:"div",attributes:{"class":"control-group control-full"},children:[{tag:"label",attributes:{"class":"control-label","for":"field-ordering-procedure",text:"Ordering Procedure"}},{tag:"div",attributes:{"class":"controls editor"},children:[{tag:"textarea",attributes:{id:"field-ordering-procedure",name:"ordering_procedure",placeholder:"Indicate how a person can go about obtaining this resource.",cols:"20",rows:"5"}}]}]}]};