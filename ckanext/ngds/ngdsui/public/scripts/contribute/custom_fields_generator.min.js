/* Copyright (c) 2014, Siemens Corporate Technology and Arizona Geological Survey *//* Copyright (c) 2014, Siemens Corporate Technology and Arizona Geological Survey *//* Copyright (c) 2014, Siemens Corporate Technology and Arizona Geological Survey */function construct_form_objects(){ngds.forms={};ngds.forms.structured_form={};ngds.forms.unstructured_form={};ngds.forms.offline_form={};ngds.forms.data_service_form={};ngds.forms.structured_form.form=ngds.util.dom_element_constructor(structured_form_raw);ngds.forms.unstructured_form.form=ngds.util.dom_element_constructor(unstructured_form_raw);ngds.forms.offline_form.form=ngds.util.dom_element_constructor(offline_form_raw);ngds.forms.data_service_form.form=ngds.util.dom_element_constructor(data_service_raw)}$(document).ready(function(){(function(){ngds.util.state.prev_resource_type=$("[name=resource_format]:checked").val();ngds.util.state.versions={};ngds.util.state.versions_dom={};ngds.util.state.layers={};ngds.util.state.layers_dom={};$("[name=content_model_version]").length>0&&$("[name=content_model_version]").parent().parent().attr("class").indexOf("error")!==-1&&$("[name=content_model_version]").prop("selectedIndex",-1);ngds.util.state["first-load"]=!0})();(function(){ngds.memorizer=function(){var e={},t=function(t,n,r){typeof e[t]=="undefined"&&(e[t]={});e[t][n]=r},n=function(t,n){return typeof e[t]=="undefined"?"":typeof e[t][n]=="undefined"?"":e[t][n]};return{memorize:t,remind:n}}()})();ngds.memorize_additional_fields=function(e){$(".additional-resource-fields input").each(function(){if($(this).attr("class")==="select2-input")return;if($(this).attr("data-module")==="autocomplete"){var t=$(this).attr("name"),n=$(this).select2("data");ngds.memorizer.memorize(e,t,n)}else if($(this).val()!==""){var t=$(this).attr("name"),n=$(this).val();ngds.memorizer.memorize(e,t,n)}});$(".additional-resource-fields select").each(function(){if($(this).val()!=="")if($(this).attr("data-module")==="autocomplete"){var t=$(this).attr("name"),n=$(this).select2("data");ngds.memorizer.memorize(e,t,n)}else{var t=$(this).attr("name"),n=$(this).val();ngds.memorizer.memorize(e,t,n)}});$(".additional-resource-fields textarea").each(function(){if($(this).val()!==""){var t=$(this).attr("name"),n=$(this).val();ngds.memorizer.memorize(e,t,n)}})};ngds.restore_additional_fields=function(e){$(".additional-resource-fields input").each(function(){if($(this).attr("class")==="select2-input")return;var t=$(this).attr("name"),n=ngds.memorizer.remind(e,t);if(n!==""){typeof n=="object"&&$(this).val(JSON.stringify(n));$(this).attr("data-module")==="autocomplete"?$(this).select2("data",n):$(this).val(n)}});$(".additional-resource-fields textarea").each(function(){var t=$(this).attr("name"),n=ngds.memorizer.remind(e,t);n!==""&&$(this).val(n)});$(".additional-resource-fields select").each(function(){var t=$(this).attr("name"),n=ngds.memorizer.remind(e,t);if(n==="")return;var r=$(this).children().filter("option");$(this).attr("data-module")==="autocomplete"?$(this).select2("data",n):r.each(function(){$(this).val()===n&&$(this).prop("selected",!0)})})};$("[data-module=resource-upload-field] label").click(function(e){var t=$(e.currentTarget).attr("for");if(t!=="field-resource-type-upload"){var n=$("#"+$(e.currentTarget).attr("for")).val();ngds.memorize_additional_fields(ngds.util.state.prev_resource_type);ngds.util.state.prev_resource_type=n;ngds.resource_type_change(n)}var n=$("#"+$(e.currentTarget).attr("for")).val();if(n==="structured"){$(".validate-message").remove();var r='<div class="validate-message">';r+='<div class="message" style="padding-top:20px;text-align:center;font-size:15px;">';r+='<a href="http://schemas.usgin.org/validate/cm" target="_blank">';r+="Use this service to make sure your structured data conforms to USGIN specifications";r+="</div></a></div>";$(e.currentTarget).parent().after(r)}else if(n==="data-service"){$(".validate-message").remove();var r='<div class="validate-message">';r+='<div class="message" style="padding-top:20px;text-align:center;font-size:15px;">';r+='<a href="http://schemas.usgin.org/validate/wfs" target="_blank">';r+="Use this service to make sure your structured data conforms to USGIN specifications";r+="</div></a></div>";$(e.currentTarget).parent().after(r)}});ngds.load_content_model_widget=function(e){ngds.initialize_content_model_widget(function(){function i(e){$("#field-content-model-version").select2("destroy");var t=e,n=function(e){var t={tag:"option",attributes:{value:e.uri,text:e.version}};return ngds.util.dom_element_constructor(t)};if(e==="None"||e==="none"){$("[name=content_model_version]").empty();$("[name=content_model_version]").append(n({uri:"None",version:"None"}));$("#field-content-model-version").select2();$("[name=content_model_version]").val()&&s($("[name=content_model_version]").val())}else if(typeof ngds.util.state["versions"][t]=="undefined")$.ajax({url:"/api/action/get_content_model_version_for_uri",data:JSON.stringify({cm_uri:t}),type:"POST",success:function(e){var r=e.result;ngds.util.state.versions[t]=r;var i=ngds.util.state.versions_dom[t]=[];$("[name=content_model_version]").empty();for(var o=0;o<r.length;o++){$("[name=content_model_version]").append(n(r[o]));i.push(n(r[o]))}ngds.memorizer.remind("structured","content_model_version")!==""&&$("#field-content-model-version option").filter("[value="+ngds.memorizer.remind("structured","content_model_version").id+"]").prop("selected",!0);$("#field-content-model-version").select2();$("[name=content_model_version]").val()&&s($("[name=content_model_version]").val())}});else{var r=ngds.util.state.versions_dom[t];$("[name=content_model_version]").empty();for(var i=0;i<r.length;i++)$("[name=content_model_version]").append(r[i])}}function s(e){$("#field-content-model-layer").select2("destroy");var t=e,n=function(e){var t={tag:"option",attributes:{value:e.layer,text:e.layer}};return ngds.util.dom_element_constructor(t)};if(e==="None"||e==="none"){$("[name=content_model_layer]").empty();$("[name=content_model_layer]").append(n({layer:"None",layer:"None"}));$("#field-content-model-layer").select2()}else if(typeof ngds.util.state["layers"][t]=="undefined")$.ajax({url:"/api/action/get_content_model_layers_for_uri",data:JSON.stringify({cm_uri:t}),type:"POST",success:function(e){var r=e.result;ngds.util.state.layers[t]=r;var i=ngds.util.state.layers_dom[t]=[];$("[name=content_model_layer]").empty();var s=$("#field-content-model-version").val().split(/[\s\/]+/).pop();for(var o=0;o<r.versions[s].length;o++){var u={layer:r.versions[s][o]};$("[name=content_model_layer]").append(n(u));i.push(n(u))}ngds.memorizer.remind("structured","content_model_version")!==""&&$("#field-content-model-layer option").filter("[value="+ngds.memorizer.remind("structured","content_model_version").id+"]").prop("selected",!0);$("#field-content-model-layer").select2()}});else{var r=ngds.util.state.layers_dom[t];$("[name=content_model_layer]").empty();for(var i=0;i<r.length;i++)$("[name=content_model_layer]").append(r[i])}}typeof $("#field-content-model")[0]!="undefined"&&ckan.module.initializeElement($("#field-content-model")[0]);if(typeof $("[name=content_model_uri]").val()!="undefined"&&$("[name=content_model_uri]").val()!=="None"){var t=$("[name=content_model_uri]").val(),n=ngds.util.state.versions_dom[t];if(typeof n!="undefined"){$("[name=content_model_version]").empty();for(var r=0;r<n.length;r++)$("[name=content_model_version]").append(n[r])}}$("[name=content_model_uri]").on("change",function(e){var t=e.val;$("[name=content_model_version]").select2("destroy");$("[name=content_model_version]").empty();$("[name=content_model_version]").select2();i(t)});$("[name=content_model_version]").on("change",function(e){var t=e.val;$("[name=content_model_layer]").select2("destroy");$("[name=content_model_layer]").empty();$("[name=content_model_layer]").select2();s(t)});ngds.restore_additional_fields(e);$("[name=content_model_uri]").length>0&&i($("[name=content_model_uri]").val())});$("[name=content_model_version]").select2();$("[name=content_model_layer]").select2();e===undefined&&$(".resource-upload-field").css("display","none");ngds.setup_responsible_party()};ngds.resource_type_change=function(e){$(".additional-resource-fields").empty();construct_form_objects();if(e==="structured"){$(".additional-resource-fields").replaceWith(ngds.forms.structured_form.form);ngds.load_content_model_widget("structured");ckan.module.initializeElement($("#field-distributor")[0]);ckan.module.initializeElement($("#field-format")[0]);$(".resource-upload-field").css("display","inline-block")}if(e==="unstructured"){$(".additional-resource-fields").replaceWith(ngds.forms.unstructured_form.form);ckan.module.initializeElement($("#field-distributor")[0]);ckan.module.initializeElement($("#field-format")[0]);$(".resource-upload-field").css("display","inline-block")}if(e==="offline-resource"){$(".additional-resource-fields").replaceWith(ngds.forms.offline_form.form);ckan.module.initializeElement($("#field-distributor")[0]);$(".resource-upload-field").css("display","none")}if(e==="data-service"){$(".additional-resource-fields").replaceWith(ngds.forms.data_service_form.form);ckan.module.initializeElement($("#field-distributor")[0]);ckan.module.initializeElement($("#field-protocol")[0]);$(".resource-upload-field").css("display","none")}ngds.setup_responsible_party();ngds.restore_additional_fields(e)};var e;ngds.setup_responsible_party=function(){if($("#field-distributor").length){try{$("#field-distributor").off("change",ngds.distributor_on_change)}catch(t){}$("#field-distributor").on("change",ngds.distributor_on_change);e||(e=setInterval(ngds.override_distrib_initSelection,10))}};ngds.distributor_on_change=function(e){try{$.parseJSON(e.val)}catch(t){ngds.responsible_parties.add_new("Add New Distributor","#field-distributor",e.val)}};ngds.override_distrib_initSelection=function(){if($("#field-distributor").data("select2")&&$("#field-distributor").data("select2").opts){clearInterval(e);e=undefined;ngds.responsible_parties.overrideInitSelection("#field-distributor");$("#field-distributor").trigger("change")}};ngds.load_content_model_widget($("[name=resource_format]:checked").val())});ngds.initialize_content_model_widget=function(e){if(typeof ngds.util.state["content_models"]=="undefined")$.ajax({url:"/api/action/get_content_models_for_ui",type:"POST",data:JSON.stringify({dummy:"dummy"}),success:function(t){ngds.util.state.content_models=t.result;var n=function(e){var t={tag:"option",attributes:{value:e.uri,text:e.title}};return ngds.util.dom_element_constructor(t)},r=ngds.util.state.content_models,i=ngds.util.state.content_models_dom=[],s=n({uri:"None",title:"None"});$("[name=content_model_uri]").append(s);i.push(s);for(var o=0;o<r.length;o++){$("[name=content_model_uri]").append(n(r[o]));i.push(n(r[o]))}e()}});else{var t=ngds.util.state.content_models_dom;for(var n=0;n<t.length;n++)$("[name=content_model_uri]").append(t[n]);e()}};var structured_form_raw={tag:"div",attributes:{"class":"additional-resource-fields"},children:[{tag:"div",attributes:{"class":"control-group control-full"},children:[{tag:"label",attributes:{"class":"control-label","for":"field-content-model",text:"Content Model"}},{tag:"div",attributes:{"class":"controls"},children:[{tag:"select",attributes:{id:"field-content-model",type:"text",name:"content_model_uri",placeholder:"Ex: Borehole Lithology Intercepts","data-module":"autocomplete"}}]}]},{tag:"div",attributes:{"class":"control-group control-full"},children:[{tag:"label",attributes:{"class":"control-label","for":"field-content-model-version",text:"Content Model Version"}},{tag:"div",attributes:{"class":"controls"},children:[{tag:"select",attributes:{id:"field-content-model-version",type:"text",name:"content_model_version",placeholder:"Ex: 1.1"}}]}]},{tag:"div",attributes:{"class":"control-group control-full"},children:[{tag:"label",attributes:{"class":"control-label","for":"field-content-model-layer",text:"Content Model Layer"}},{tag:"div",attributes:{"class":"controls"},children:[{tag:"select",attributes:{id:"field-content-model-layer",type:"text",name:"content_model_layer"}}]}]},{tag:"div",attributes:{"class":"control-group control-full"},children:[{tag:"label",attributes:{"class":"control-label","for":"field-distributor",text:"Distributor"}},{tag:"div",attributes:{"class":"controls"},children:[{tag:"input",attributes:{id:"field-distributor",type:"text",name:"distributor",placeholder:"Ex: John Doe","data-module-label":"name","data-module":"autocomplete","data-module-source":"responsible_parties?q=?","data-module-key":"value"}}]}]},{tag:"div",attributes:{"class":"control-group control-full"},children:[{tag:"label",attributes:{"class":"control-label","for":"field-format",text:"Format"}},{tag:"div",attributes:{"class":"controls"},children:[{tag:"input",attributes:{id:"field-format",type:"text",name:"format",placeholder:"eg. CSV, XML or JSON","data-module":"autocomplete","data-module-source":"/api/2/util/resource/format_autocomplete?incomplete=?"}}]}]}]},data_service_raw={tag:"div",attributes:{"class":"additional-resource-fields"},children:[{tag:"div",attributes:{"class":"control-group control-full"},children:[{tag:"label",attributes:{"class":"control-label","for":"field-distributor",text:"Distributor"}},{tag:"div",attributes:{"class":"controls"},children:[{tag:"input",attributes:{id:"field-distributor",type:"text",name:"distributor",placeholder:"Ex: John Doe","data-module-label":"name","data-module":"autocomplete","data-module-source":"responsible_parties?q=?","data-module-key":"value"}}]}]},{tag:"div",attributes:{"class":"control-group control-medium"},children:[{tag:"label",attributes:{"class":"control-label","for":"field-protocol",text:"Protocol"}},{tag:"div",attributes:{"class":"controls"},children:[{tag:"select",attributes:{id:"field-protocol",name:"protocol",placeholder:"Ex: WMS","data-module":"autocomplete"},children:[{tag:"option",attributes:{text:"WMS",value:"OGC:WMS"}},{tag:"option",attributes:{text:"WFS",value:"OGC:WFS"}},{tag:"option",attributes:{text:"ESRI Map Service",value:"ESRI"}},{tag:"option",attributes:{text:"CSW",value:"OGC:CSW"}},{tag:"option",attributes:{text:"SOS",value:"OGC:SOS"}},{tag:"option",attributes:{text:"OPeNDAP",value:"OPeNDAP"}},{tag:"option",attributes:{text:"Other",value:"other"}}]}]}]},{tag:"div",attributes:{"class":"control-group control-full"},children:[{tag:"label",attributes:{"class":"control-label","for":"field-layer",text:"Layer"}},{tag:"div",attributes:{"class":"controls"},children:[{tag:"input",attributes:{type:"text",name:"layer",id:"field-layer",placeholder:"A layer name that can be used to access this resource using the protocol selected above. Eg. A Geoserver WMS layer."}}]}]}]},unstructured_form_raw={tag:"div",attributes:{"class":"additional-resource-fields"},children:[{tag:"div",attributes:{"class":"control-group control-full"},children:[{tag:"label",attributes:{"class":"control-label","for":"field-distributor",text:"Distributor"}},{tag:"div",attributes:{"class":"controls"},children:[{tag:"input",attributes:{id:"field-distributor",type:"text",name:"distributor",placeholder:"Ex: John Doe","data-module-label":"name","data-module":"autocomplete","data-module-source":"responsible_parties?q=?","data-module-key":"value"}}]}]},{tag:"div",attributes:{"class":"control-group control-full"},children:[{tag:"label",attributes:{"class":"control-label","for":"field-format",text:"Format"}},{tag:"div",attributes:{"class":"controls"},children:[{tag:"input",attributes:{id:"field-format",type:"text",name:"format",placeholder:"eg. CSV, XML or JSON","data-module":"autocomplete","data-module-source":"/api/2/util/resource/format_autocomplete?incomplete=?"}}]}]}]},offline_form_raw={tag:"div",attributes:{"class":"additional-resource-fields"},children:[{tag:"div",attributes:{"class":"control-group control-full"},children:[{tag:"label",attributes:{"class":"control-label","for":"field-distributor",text:"Distributor"}},{tag:"div",attributes:{"class":"controls"},children:[{tag:"input",attributes:{id:"field-distributor",type:"text",name:"distributor",placeholder:"Ex: John Doe","data-module-label":"name","data-module":"autocomplete","data-module-source":"responsible_parties?q=?","data-module-key":"value"}}]},{tag:"label",attributes:{"class":"control-label","for":"field-ordering-procedure",text:"Ordering Procedure"}},{tag:"div",attributes:{"class":"controls editor"},children:[{tag:"textarea",attributes:{id:"field-ordering-procedure",name:"ordering_procedure",placeholder:"Indicate how a person can go about obtaining this resource.",cols:"20",rows:"5"}}]}]}]};