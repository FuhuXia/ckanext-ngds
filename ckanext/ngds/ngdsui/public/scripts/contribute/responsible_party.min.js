var ngds=ngds||(ngds={});ngds.responsible_party=function(){var b=this;var a=function(d,k){(function i(l){var m=typeof $(l.rs_name)==="undefined";var n=typeof $(l.rs_email)==="undefined";var o=typeof $(l.rs_fake)==="undefined";if(m||n||o){throw"Failed sanity check"}})(d);b.rs_name=d.rs_name;b.rs_email=d.rs_email;b.rs_fake=d.rs_fake;b.rs=d.rs;b.rs_slug="#"+b.rs.replace("#","")+"_slug";b.rs_token=b.rs.replace("#","");var j=ngds.autocomplete(b.rs_fake,"/responsible_parties","q",["name","email"],"name");var e=b.rs_name;var g=b.rs_email;b.slugify=this.slugify=function(s){var s=s||{};console.log("Glug glug");var o=ngds.util.state[b.rs_token]||(ngds.util.state[b.rs_token]={});var r={};r.name=s.name||$(b.rs_name).val();r.email=s.email||$(b.rs_email).val();var q=r.name;var p=r.email;if(q===""||p===""){return}var n=JSON.stringify(r);$(b.rs).val(n);if(typeof k!=="undefined"){k(s)}setTimeout(function(){$(b.rs_fake).val("")});ngds.util.state[b.rs_token]=n;$(d.slug_container).empty();var m=$("<span/>",{"class":"ngds-tag",text:r.name,title:"Name : "+q+", Email : "+p});$(d.slug_container).append(m);var l=$("<span/>",{text:"X","class":"close-button-transform",style:"cursor:pointer"});m.append(l);l.on("click",function(t){$(t.currentTarget.parentElement).fadeOut(500,function(){var u=t.currentTarget.parentElement;u.remove();$(b.rs).val("")})})};j.proxy(b.rs,b.slugify);if($(b.rs_fake).val()!==""){var h="";try{var h=JSON.parse($(b.rs_fake).val());$(b.rs_fake).val("");b.slugify(h)}catch(f){}}c()};var c=function(){var d=$(b.rs_fake);b.rs_create_anch=$("<a/>",{"class":"icon-plus "+b.rs.replace("#",""),style:"cursor:pointer;"});b.rs_create_anch.on("click",function(q){b.rs_create_anch.hide();$(b.rs_slug).hide();$(b.rs_fake).show();var j=b.rs.replace("#","");var l=j+"_c_name";var f=j+"_c_email";var p=j+"_c_create_button";var k=j+"_c_cancel_button";var o=j+"_c_form";var h={"class":o,responsible_parties:[{label:"Name",type:"text",name:l,id:l,"class":o},{label:"Email",type:"text",name:l,id:f,"class":o},{button:"Create",id:p,"class":o},{button:"Cancel",id:k,"class":o}]};b.rs_create_anch.after(Mustache.render(ngds.add_responsible_party_template,h));var e=$("#"+l);var n=$("#"+f);var g=$("#"+p);var i=$("#"+k);var m=$("."+o);g.on("click",function(){$.ajax({url:"/api/action/additional_metadata",type:"POST",data:JSON.stringify({process:"create",model:"ResponsibleParty",data:{name:e.val(),email:n.val()}}),success:function(r){b.slugify(r.result);b.rs_create_anch.show();m.remove()}})});i.on("click",function(r){m.remove();b.rs_create_anch.show()})});d.after(b.rs_create_anch)};return{responsibilify:a}};