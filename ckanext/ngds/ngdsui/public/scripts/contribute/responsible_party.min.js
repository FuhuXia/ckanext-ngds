/* Copyright (c) 2014, Siemens Corporate Technology and Arizona Geological Survey *//* Copyright (c) 2014, Siemens Corporate Technology and Arizona Geological Survey *//* Copyright (c) 2014, Siemens Corporate Technology and Arizona Geological Survey */var ngds=ngds||(ngds={});ngds.responsible_party=function(){var e=this,t=function(t,r){(function(t){var n=typeof $(t.rs_name)=="undefined",r=typeof $(t.rs_email)=="undefined",i=typeof $(t.rs_fake)=="undefined";if(n||r||i)throw"Failed sanity check"})(t);e.rs_name=t.rs_name;e.rs_email=t.rs_email;e.rs_fake=t.rs_fake;e.rs=t.rs;e.rs_slug="#"+e.rs.replace("#","")+"_slug";e.rs_token=e.rs.replace("#","");var i=ngds.autocomplete(e.rs_fake,"/responsible_parties","q",["name","email"],"name"),s=e.rs_name,o=e.rs_email;e.slugify=this.slugify=function(n){var n=n||{},i=ngds.util.state[e.rs_token]||(ngds.util.state[e.rs_token]={}),s={};s.name=n.name||$(e.rs_name).val();s.email=n.email||$(e.rs_email).val();var o=s.name,u=s.email;if(o===""||u==="")return;var a=JSON.stringify(s);$(e.rs).val(a);typeof r!="undefined"&&r(n);setTimeout(function(){$(e.rs_fake).val("")});ngds.util.state[e.rs_token]=a;$(t.slug_container).empty();var f=$("<span/>",{"class":"ngds-tag",text:s.name,title:"Name : "+o+", Email : "+u});$(t.slug_container).append(f);var l=$("<span/>",{text:"X","class":"close-button-transform",style:"cursor:pointer"});f.append(l);l.on("click",function(t){$(t.currentTarget.parentElement).fadeOut(500,function(){var n=t.currentTarget.parentElement;n.remove();$(e.rs).val("")})})};i.proxy(e.rs,e.slugify);if($(e.rs_fake).val()!==""){var u="";try{var u=JSON.parse($(e.rs_fake).val());$(e.rs_fake).val("");e.slugify(u)}catch(a){}}n()},n=function(){var t=$(e.rs_fake);e.rs_create_anch=$("<a/>",{"class":"icon-plus "+e.rs.replace("#",""),style:"cursor:pointer;"});e.rs_create_anch.on("click",function(t){e.rs_create_anch.hide();$(e.rs_slug).hide();$(e.rs_fake).show();var n=e.rs.replace("#",""),r=n+"_c_name",i=n+"_c_email",s=n+"_c_org",o=n+"_c_ph",u=n+"_c_street",a=n+"_c_state",f=n+"_c_city",l=n+"_c_zip",c=n+"_c_country",h=n+"_c_create_button",p=n+"_c_cancel_button",d=n+"_c_form",v=[{label:"Name",label_class:d,input_name:r,input_class:d,input_id:r},{label:"Email",label_class:d,input_name:i,input_class:d,input_id:i},{label:"Organization",label_class:d,input_name:n+"org",input_class:d,input_id:s},{label:"Phone",label_class:d,input_name:n+"ph",input_class:d,input_id:o},{label:"Street",label_class:d,input_name:n+"street",input_class:d,input_id:u},{label:"City",label_class:d,input_name:n+"city",input_class:d,input_id:f},{label:"State",label_class:d,input_name:n+"state",input_class:d,input_id:a},{label:"Zip",label_class:d,input_name:n+"zip",input_class:d,input_id:l},{label:"Country",label_class:d,input_name:n+"-country",input_class:d,input_id:c},{button:"Create",id:h,"class":d},{button:"Cancel",id:p,"class":d}];e.rs_create_anch.after(ngds.rs_generator(v,d,n));var m=$("#"+r),g=$("#"+i),y=$("#"+s),b=$("#"+o),w=$("#"+u),E=$("#"+f),S=$("#"+a),x=$("#"+l),T=$("#"+c),N=$("#"+h),C=$("#"+p);N.on("click",function(){$.ajax({url:"/api/action/additional_metadata",type:"POST",data:JSON.stringify({process:"create",model:"ResponsibleParty",data:{name:m.val(),email:g.val(),organization:y.val(),phone:b.val(),street:w.val(),city:E.val(),state:S.val(),zip:x.val(),country:T.val()}}),success:function(t){console.log(t);e.slugify(t.result);e.rs_create_anch.show();k.remove()},error:function(){$(".add-responsible-party .tab").after($("<div/>",{"class":"error-block",text:"Invalid form entries"}))}})});var k=$("."+d);C.on("click",function(t){k.remove();e.rs_create_anch.show()})});t.after(e.rs_create_anch)};return{responsibilify:t}};