var populate_content_models=function(){var a=$(".content_model");if(typeof options==="undefined"){options=[];content_models={};$.ajax({url:"/api/action/contentmodel_list_short",type:"POST",data:JSON.stringify({dummy:"appendix"}),success:function(c){for(var d=0;d<c.result.length;d++){content_models[c.result[d].uri]=c.result[d]}options.push($("<option/>",{value:"none",text:"None"}).appendTo(a));for(var e in content_models){options.push($("<option/>",{value:e,text:content_models[e].title}).appendTo(a))}}});return}for(var b=0;b<options.length;b++){options[b].appendTo(a)}};var populate_content_model_versions=function(){var c=$(".content_model_marker");var b=$(".content_model");if(b.val()==="none"){return}$(".content_model_version_marker").remove();var a={form:[{label:"Version",name:"content_model_version",top_classes:function(){return"content_model_version_marker"},tag:"select","class":function(){return"content_model_version"}}]};b.after(Mustache.render(ngds.structured_form_template,a));var d=$(".content_model_version");var f=b.val();for(var e=0;e<content_models[f].versions.length;e++){$("<option/>",{value:content_models[f].versions[e].uri,text:content_models[f].versions[e].version}).appendTo(d)}};$(".form-body").on("change",".content_model",function(){populate_content_model_versions()});$("#file").on("change",function(c){var d=new Date().toISOString();var b=$("#file").val();var a=b.substring(b.lastIndexOf("\\")+1);$("#key1").val(d+"/"+a);$("#key2").val(d+"/"+a);$("#resource_type").val($("[name=resource_format]:checked").val());$("#file-upload-form").submit()});var populate_form=function(a){for(property in a){if($("[name="+property+"]").length>0){if(property==="distributor"){}$("[name="+property+"]").val(a[property])}}};var activate_populate_form=function(b){render_forms(b.resource_format);populate_form(b);$("#resource_type-selection").prop("disabled",true);$("input[type=radio]").prop("disabled",true);var a=get_prop($("#field-url").val(),"name");var c=get_prop($("#field-url").val(),"extension");$("[name=name]").val(a);$("[name=format]").val(c)};var get_prop=function(a,c){if(typeof a==="undefined"||a.length===0){return""}var b=a.substring(a.lastIndexOf("/")+1);if(c==="name"){return b.split(".")[0]}if(c==="extension"){return b.split(".")[1]}};position_file_uploader();var render_forms=function(a){$(".form-body").empty();if(a==="structured"||a==="unstructured"){$("[name=upload_type_selection]").prop("checked",true)}else{$("[name=upload_type_selection]").prop("checked",false)}if(a==="structured"){$("#resource_type-structured").prop("checked",true);$(".form-body").html(Mustache.render(ngds.structured_form_template,structured_form));position_file_uploader("#field-url");populate_content_models()}if(a==="unstructured"){$("#resource_type-unstructured").prop("checked",true);$(".form-body").html(Mustache.render(ngds.structured_form_template,unstructured_form));position_file_uploader("#field-url")}if(a==="offline-resource"){$("#offline-resource").prop("checked",true);$(".form-body").html(Mustache.render(ngds.structured_form_template,offline_resource_form));position_file_uploader()}if(a==="data-service"){$(".form-body").html(Mustache.render(ngds.structured_form_template,link_data_service_form));position_file_uploader()}if(a==="data-service"||a==="unstructured"||a==="structured"){responsibilified=new ngds.responsible_party();responsibilified.responsibilify({rs_name:"#distributor_name",rs_email:"#distributor_email",rs_fake:"#distributor_fake",rs:"#distributor",slug_container:".distributor-tag"},function(b){$("[name='distributor_name']").val(b.name);$("[name='distributor_email']").val(b.email)})}};$('input[name="resource_format"]').on("change",function(a){var c=a.currentTarget.id;var b="";if(c==="resource_type-unstructured"){b="unstructured"}if(c==="resource_type-structured"){b="structured"}if(c==="offline-resource"){b="offline-resource"}if(c==="data-service"){b="data-service"}render_forms(b)});$("#go-metadata").click(function(){$.ajax({url:"/ngds/contribute/validate_resource",data:$(".dataset-form").serializeArray(),success:function(a){if(a.success===true){$(".dataset-form").append($("<input/>",{type:"hidden",name:"save",value:"go-metadata"}));$(".dataset-form").submit()}else{ngds.publish("Notifications.received",a)}}})});if(typeof continuation!=="undefined"){for(var i=0;i<continuation.length;i++){$("[name="+continuation.field+"]").val(continuation.value)}};