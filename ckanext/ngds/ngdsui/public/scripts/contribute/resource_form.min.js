/* Copyright (c) 2014, Siemens Corporate Technology and Arizona Geological Survey *//* Copyright (c) 2014, Siemens Corporate Technology and Arizona Geological Survey *//* Copyright (c) 2014, Siemens Corporate Technology and Arizona Geological Survey */var populate_content_models=function(){var e=$(".content_model");if(typeof options=="undefined"){options=[];options.push($("<option/>",{value:"none",text:"None"}).appendTo(e));for(var t in content_models)options.push($("<option/>",{value:t,text:content_models[t].title}).appendTo(e));return}for(var n=0;n<options.length;n++)options[n].appendTo(e)},populate_content_model_versions=function(){var e=$(".content_model_marker"),t=$(".content_model");if(t.val()==="none")return;$(".content_model_version_marker").remove();var n=[{label:"Version",div_classes:["content_model_version_marker"],inputs:[{tag:"select",attributes:{"class":"structured-input content_model_version",name:"content_model_version"}}]}];t.after(form_generator(n));var r=$(".content_model_version"),i=t.val();for(var s=0;s<content_models[i].versions.length;s++)$("<option/>",{value:content_models[i].versions[s].uri,text:content_models[i].versions[s].version}).appendTo(r)};$("#file").on("change",function(e){var t=(new Date).toISOString(),n=$("#file").val(),r=n.substring(n.lastIndexOf("\\")+1);$("#key1").val(t+"/"+r);$("#key2").val(t+"/"+r);$("#resource_type").val($("[name=resource_format]:checked").val());$("#file-upload-form").submit()});var populate_form=function(e){for(property in e)if($("[name="+property+"]").length>0){property==="distributor";$("[name="+property+"]").val(e[property])}},activate_populate_form=function(e){render_forms(e.resource_format);populate_form(e);$("#resource_type-selection").prop("disabled",!0);$("input[type=radio]").prop("disabled",!0);var t=get_prop($("#field-url").val(),"name"),n=get_prop($("#field-url").val(),"extension");$("[name=name]").val(t);$("[name=format]").val(n)},get_prop=function(e,t){if(typeof e=="undefined"||e.length===0)return"";var n=e.substring(e.lastIndexOf("/")+1);if(t==="name")return n.split(".")[0];if(t==="extension")return n.split(".")[1]};position_file_uploader();var render_forms=function(e){$(".form-body").empty();e==="structured"||e==="unstructured"?$("[name=upload_type_selection]").prop("checked",!0):$("[name=upload_type_selection]").prop("checked",!1);if(e==="structured"){$("#resource_type-structured").prop("checked",!0);$(".form-body").replaceWith(form_generator(ngds.form.structured_form_fields));position_file_uploader("#field-url");populate_content_models();$(".form-body").on("change",".content_model",function(){populate_content_model_versions()})}if(e==="unstructured"){$("#resource_type-unstructured").prop("checked",!0);$(".form-body").replaceWith(form_generator(ngds.form.unstructured_form_fields));ngds.util.state.edit_mode!==!0&&position_file_uploader("#field-url")}if(e==="offline-resource"){$("#offline-resource").prop("checked",!0);$(".form-body").replaceWith(form_generator(ngds.form.offline_form_fields));position_file_uploader()}if(e==="data-service"){$(".form-body").replaceWith(form_generator(ngds.form.data_service_form_fields));position_file_uploader()}if(e==="data-service"||e==="unstructured"||e==="structured"){responsibilified=new ngds.responsible_party;responsibilified.responsibilify({rs_name:"#distributor_name",rs_email:"#distributor_email",rs_fake:"#distributor_fake",rs:"#distributor",slug_container:".distributor-tag"},function(e){$("[name='distributor_name']").val(e.name);$("[name='distributor_email']").val(e.email)})}setTimeout(function(){window.onbeforeunload=null},500);console.log(window.onbeforeunload);ngds.publish("Forms.reinitialize",{})};$('input[name="resource_format"]').on("change",function(e){var t=e.currentTarget.id,n="";t==="resource_type-unstructured"&&(n="unstructured");t==="resource_type-structured"&&(n="structured");t==="offline-resource"&&(n="offline-resource");t==="data-service"&&(n="data-service");render_forms(n);window.onbeforeunload=null});$("#go-metadata").click(function(){$.ajax({url:"/ngds/contribute/validate_resource",data:$(".dataset-form").serializeArray(),success:function(e){if(e.success===!0){$(".dataset-form").append($("<input/>",{type:"hidden",name:"save",value:"go-metadata"}));$(".dataset-form").submit()}else ngds.publish("Notifications.received",e)}})});if(typeof continuation!="undefined")for(var i=0;i<continuation.length;i++)$("[name="+continuation.field+"]").vall(continuation.value);$('[name="resource_format"]').on("click",function(e){var t=e.currentTarget.id;console.log(t)});