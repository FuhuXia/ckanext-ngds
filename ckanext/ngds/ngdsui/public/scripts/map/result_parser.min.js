ngds.render_search_results=function(q,l){var n=new ngds.util.sequence_generator();var g=l.count;var p=l.results;var f=l.query;ngds.log("Received "+g+" results : "+p,p);$(".results").remove();var s="results";if(ngds.Map.is_fullscreen()===true){s=s+" large"}$(".map-search-results").prepend($("<div/>",{"class":s,id:"results"}));var m={};for(var t=0;t<p.length;t++){var o=false;for(var r=0;r<p[t].resources.length;r++){var b=p[t].resources[r];if(b.protocol==="OGC:WMS"){o=true;m[p[t].id]=m[p[t].id]||(m[p[t].id]=[]);var h=b.layer_name;m[p[t].id].push({id:b.id,url:b.url.split("?")[0],layer:h,name:b.description})}}p[t]["type"]=p[t]["type"][0].toUpperCase()+p[t]["type"].slice(1,p[t]["type"].length);var e={tag:"div",attributes:{"class":"result result-"+n.next()},children:[{tag:"p",attributes:{"class":"description-wrapper"},children:[{tag:"a",attributes:{"class":"description",href:["/dataset",p[t]["name"]].join("/"),target:"_blank",text:ngds.util.get_n_chars(p[t]["title"],38)}}]},{tag:"p",attributes:{"class":"notes",text:ngds.util.get_n_chars(p[t]["notes"],58)}},{tag:"div",attributes:{"class":"additional-dataset-info"},children:[{tag:"p",attributes:{"class":"type",text:p[t]["type"]}},{tag:"p",attributes:{"class":"published",text:"Published "+new Date(p[t]["metadata_created"]).toLocaleDateString()}}]}]};if(o===true){e.children.push({tag:"button",attributes:{"class":"wms ngds-slug",text:"WMS",id:p[t].id}})}var c=ngds.ckandataset(p[t]).get_feature_type()["type"];var u={};var d=n.current("alph");ngds.publish("Map.feature_received",{feature:p[t],seq:n.current(),alph_seq:d});if(c==="Point"){u={tag:"div",attributes:{"class":"result-marker-container marker-"+n.current()},priority:1,children:[{tag:"img",attributes:{src:"/images/marker.png","class":"result-marker"}},{tag:"span",attributes:{"class":"result-marker-label marker-label-"+n.current(),text:d}}]};e.children.push(u)}var v=ngds.util.dom_element_constructor(e);$(".results").append(v);var a=ngds.util.dom_element_constructor({tag:"div",attributes:{"class":"results-text"},children:[{tag:"p",attributes:{text:"Found "+g+' results for "'+f+'"',"class":"reader"}}]})}$(".results").before(a);x=$(".results").jScrollPane({contentWidth:"0px"});var k=k||(k=0);$(".wms").click(function(y){var A=y.currentTarget.id;var j="";try{var j=$(y.currentTarget).siblings().find("img").next()[0].textContent+" : "}catch(z){}for(var w=0;w<m[A].length;w++){var i=L.tileLayer.wms(m[A][w].url,{layers:m[A][w].layer,format:"image/png",transparent:true,attribution:"NGDS",tileSize:128,opacity:0.9999});layer_control.addOverlay(i,j+m[A][w].name);ngds.Map.map.addLayer(i)}alert("The Web Map Services you requested have been added to the map.")})};ngds.subscribe("Map.results_received",ngds.render_search_results);