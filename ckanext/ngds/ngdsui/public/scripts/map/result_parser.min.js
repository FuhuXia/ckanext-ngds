var ngds=ngds||(ngds={});ngds.render_search_results=function(e,t){var n=new ngds.util.sequence_generator,r=t.count,i=t.results,s=t.query;ngds.log("Received "+r+" results : "+i,i);$(".results").remove();var o="results visibility-managed";ngds.util.state.colorify={};ngds.Map.is_fullscreen()===!0&&(o+=" large");$(".map-search-results").prepend($("<div/>",{"class":o,id:"results"}));var u={};for(var a=0;a<i.length;a++){var f=!1;for(var l=0;l<i[a].resources.length;l++){var c=i[a].resources[l];if(c.protocol==="OGC:WMS"){f=!0;u[i[a].id]=u[i[a].id]||(u[i[a].id]=[]);u[i[a].id].push({id:c.id,url:c.url.split("?")[0],layer:"undefined",name:c.description})}}i[a].type=i[a].type[0].toUpperCase()+i[a].type.slice(1,i[a].type.length);var h={tag:"div",attributes:{"class":"result result-"+n.next()},children:[{tag:"p",attributes:{"class":"description-wrapper description",text:ngds.util.get_n_chars(i[a].title,30)},children:[]},{tag:"div",attributes:{"class":"additional-dataset-info"},children:[{tag:"p",attributes:{"class":"type",text:i[a].type}},{tag:"p",attributes:{"class":"published",text:"Published "+function(e){var t=e.getUTCDate(),n=e.getUTCMonth()+1,r=e.getFullYear();return[n,t,r].join("/")}(new Date(i[a].metadata_created))}}]},{tag:"div",attributes:{"class":"visibility-toggler"},children:[{tag:"button",attributes:{"class":"visible","data-seq":n.current(),title:"Hide/Show this result on the map"}}]}]},p={tag:"div",attributes:{"class":"dataset-resources"}};if(f===!0){p.children=[];p.children.push({tag:"button",attributes:{"class":"wms ngds-slug",text:"WMS",id:i[a].id}})}h.children.push(p);var d=ngds.ckandataset(i[a]).get_feature_type().type,v={},m=n.current("alph");if(d==="Point")v={tag:"div",attributes:{"class":"result-marker-container marker-"+n.current()},priority:1,children:[{tag:"div",attributes:{"class":"red-marker"}}]};else{var g=ngds.util.rotate_color();ngds.util.state.colorify[n.current()]=g;v={tag:"div",attributes:{"class":"red-box",style:"background-color:"+g},priority:1}}ngds.publish("Map.feature_received",{feature:i[a],seq:n.current(),alph_seq:m});h.children.push(v);var y=ngds.util.dom_element_constructor(h);$(".results").append(y)}var b=ngds.util.dom_element_constructor({tag:"div",attributes:{"class":"results-text visibility-managed"},children:[{tag:"div",attributes:{"class":"search-tools"},children:[{tag:"div",attributes:{"class":"visibility-toggler"},children:[function(e){if(Number(e)!==0)return{tag:"button",attributes:{"class":"visible",title:"Hide/Show all results on the map.","data-seq":0}}}(r)]},{tag:"div",attributes:{"class":"clear-map-state"},children:[{tag:"button",attributes:{"class":"clear-map-state",title:"Clear search"}}]}]},{tag:"div",attributes:{"class":"reader"},children:[{tag:"p",attributes:{text:"Found "+r+function(e){return Number(e)===1?" result":" results"}(r)+function(e,t){if(t==="")return"";if(t!==""&&t.match(/near/)!==null){var n=[];t.match(/ near /)!==null?n=t.split(" near "):n=t.split("near ");return n[0]===""?" near "+n[1]:' for "'+n[0]+'"'+" near "+n[1]}if(t!=="")return' for "'+t+'"'}(r,s),"class":"reader"}}]}]});$(".results").before(b);var w=w||(w=0);(function(){$(document).ready(function(){$(".clear-map-state").on("click",function(){ngds.util.clear_map_state();ngds.Map.get_layer("drawnItems").clearLayers();ngds.publish("Map.clear_rect",{})})})})();ngds.publish("Map.results_rendered",{})};ngds.subscribe("Map.results_received",ngds.render_search_results);