ngds.Search=function(){var a="";ngds.subscribe("Map.area_selected",function(g,f){if(f.type==="rectangle"){bbox=new ngds.Map.BoundingBox();bbox.construct_from_leaflet_shape(f.feature["rect"]);a={ext_bbox:bbox.get_bbox_array().join(",")}}else{if(f.type==="polygon"){var e=[];$.each(f.feature["poly"]._latlngs,function(h,i){e.push([i.lat,i.lng])});a={poly:e}}}});var d=this;var c=$(".search-results-page-nums");var b=function(j){var f="";var m=j.rows;var k=j.action;var l=j.page;ngds.Map.cur_page=l;var g=(l-1)*m;if(typeof j.q==="undefined"){f=d._q}else{d._q=j.q;f=d._q}ngds.Map.current_query=d._q;ngds.log("Searching for term : "+f+", rows : "+m+", page : "+l+" start : "+g);if(a===""){var h=new L.LatLng(-90,-180),i=new L.LatLng(90,180),e=new L.LatLngBounds(h,i);bbox=new ngds.Map.BoundingBox();bbox.store_raw(e);a={ext_bbox:bbox.get_bbox_array().join(",")}}k({rows:m,q:f,start:g,extras:a},function(o){ngds.publish("Map.results_received",{results:o.result.results,query:ngds.Map.current_query,count:o.result.count});var r=Math.ceil(o.result.count/m);var q=$(".search-results-page-nums");for(var p=1;p<r+1;p++){var s=ngds.util.dom_element_constructor({tag:"a",attributes:{"class":"page-num",text:p}});q.append(s);if(parseInt(ngds.Map.cur_page)===p){var n=s;n.addClass("page-active")}}})};return{go_to:b}};