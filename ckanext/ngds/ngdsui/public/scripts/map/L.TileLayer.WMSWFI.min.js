L.TileLayer.BetterWMS=L.TileLayer.WMS.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:false,srs:"EPSG:4326"},onAdd:function(a){L.TileLayer.WMS.prototype.onAdd.call(this,a);a.on("click",this.getFeatureInfo,this)},onRemove:function(a){L.TileLayer.WMS.prototype.onRemove.call(this,a);a.off("click",this.getFeatureInfo,this)},getFeatureInfo:function(a){var b=this.getFeatureInfoUrl(a.latlng),c=L.Util.bind(this.showGetFeatureInfo,this);$.ajax({url:b,success:function(f,d,g){console.log(f);var e=typeof f==="string"?null:f;c(e,a.latlng,f)},error:function(f,d,e){c(e)}})},getFeatureInfoUrl:function(d){var a=this._map.latLngToContainerPoint(d,this._map.getZoom()),b=this._map.getSize(),c={request:"GetFeatureInfo",service:"WMS",srs:"EPSG:4326",transparent:true,version:this.wmsParams.version,format:this.wmsParams.format,bbox:this._map.getBounds().toBBoxString(),height:b.y,width:b.x,layers:this.wmsParams.layers,query_layers:this.wmsParams.layers,info_format:"text/html"};c[c.version==="1.3.0"?"i":"x"]=a.x;c[c.version==="1.3.0"?"j":"y"]=a.y;return this._url+L.Util.getParamString(c,this._url,true)},showGetFeatureInfo:function(b,c,a){if(b){console.log(b);return}L.popup({maxWidth:800}).setLatLng(c).setContent(a).openOn(this._map)}});L.tileLayer.betterWms=function(b,a){return new L.TileLayer.BetterWMS(b,a)};