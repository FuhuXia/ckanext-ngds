/* Copyright (c) 2014, Siemens Coporate Technology and Arizona Geological Survey */
$(document).ready(function(){var c=setInterval(a,10);function a(){if($("#field-authors").data("select2")&&$("#field-authors").data("select2").opts){clearInterval(c);ngds.responsible_parties.overrideInitSelection("#field-authors");$("#field-authors").trigger("change")}}var b=setInterval(d,10);function d(){if($("#field-maintainer").data("select2")&&$("#field-maintainer").data("select2").opts){clearInterval(b);ngds.responsible_parties.overrideInitSelection("#field-maintainer");$("#field-maintainer").trigger("change")}}$("#field-authors").on("change",function(j){if(j.added&&(j.added.id==j.added.text)){ngds.responsible_parties.add_new("Add New Author","#field-authors",j.added)}if(j.removed){var h=$("#field-authors").select2("data");if(h.length>0){var k=h[0].id;for(var f=1;f<h.length;f++){k+=","+h[f].id}$("#field-authors").val(k)}else{$("#field-authors").val("")}}var g=$("#field-authors").val();g=g.replace(/\[/g,"").replace(/\]/g,"").replace(/^s+|\s+$/g,"");if(g[0]==","){g=g.substring(1)}$("#field-authors").val("["+g+"]")});$("#field-maintainer").on("change",function(g){try{$.parseJSON(g.val)}catch(f){ngds.responsible_parties.add_new("Add New Maintainer","#field-maintainer",g.val)}});ngds.responsible_parties={initSelection:function(f,i){var h=[];try{var e=$.parseJSON(f.val());if(e instanceof Array){$.each(e,function(j,k){h.push({id:JSON.stringify(k),text:k.name})});f.val("");i(h);if($(f).data("select2").opts.multiple&&$(f).val()[0]!="["){$(f).val("["+$(f).val()+"]")}}else{i({id:JSON.stringify(e),text:e.name})}}catch(g){}},overrideInitSelection:function(e){$(e).data("select2").opts.initSelection=ngds.responsible_parties.initSelection;$(e).data("select2").opts.formatSelection=function(i,f){try{var g=JSON.parse(i.id);return"<span title='"+g.name+"\n"+g.email+"'>"+i.text+"</span>"}catch(h){return i.text}}},add_new:function(f,k,h){var i=['<div class="modal" style="top: 10%">','<div class="modal-header">','<button type="button" class="close" data-dismiss="modal">Ã—</button>',"<h3>",f,"</h3>","</div>",'<div class="modal-body">','<div class="add-responsible">','<label id="rs_name_lbl" for="rs_name">Name<sup class="mandatory">*</sup></label><input type="text" id="rs_name" /></div>','<div class="add-responsible" style="margin-top: 0">','<div class="add-err-label"/><div id="rs_name_err" class="missing-field-hide">Missing Field</div></div>','<div class="add-responsible">','<label id="rs_email_lbl" for="rs_email">Email<sup class="mandatory">*</sup></label><input type="email" id="rs_email" /></div>','<div class="add-responsible" style="margin-top: 0">','<div class="add-err-label"/><div id="rs_email_err" class="missing-field-hide">Missing Field</div><div id="rs_email_dup" class="missing-field-hide">Email Already Exists</div></div>','<div class="add-responsible">','<label for="rs_org">Organization</label><input type="text" id="rs_org" /></div>','<div class="add-responsible">','<label for="rs_phone">Phone</label><input type="text" id="rs_phone" /></div>','<div class="add-responsible">','<label for="rs_street">Street Address</label><input type="text" id="rs_street" /></div>','<div class="add-responsible">','<label for="rs_city">City</label><input type="text" id="rs_city" /></div>','<div class="add-responsible">','<label for="rs_state">State</label><input type="text" id="rs_state" /></div>','<div class="add-responsible">','<label for="rs_zip">Zipcode</label><input type="text" id="rs_zip" /></div>','<div class="add-responsible">','<label for="rs_country">Country</label><input type="text" id="rs_country" /></div>',"</div>",'<div class="modal-footer">','<button class="btn btn-cancel">Cancel</button>','<button class="btn btn-primary">Confirm</button>',"</div>","</div>"].join("");var g=$(i);var j=g.modal({show:true});var e=(h.id||h);if(e.indexOf("@")>=0){$("#rs_email").val(e)}else{$("#rs_name").val(e)}g.on("click",".btn-primary",function(l){l.preventDefault();var n=false;$(".modal #rs_email_dup").removeClass("missing-field-show").addClass("missing-field-hide");$(".modal #rs_email").removeClass("required");$(".modal #rs_email_lbl").removeClass("required");if($(".modal #rs_name").val()==""){$(".modal #rs_name").addClass("required");$(".modal #rs_name_lbl").addClass("required");$(".modal #rs_name_err").addClass("missing-field-show").removeClass("missing-field-hide");n=true}else{$(".modal #rs_name").removeClass("required");$(".modal #rs_name_lbl").removeClass("required");$(".modal #rs_name_err").removeClass("missing-field-show").addClass("missing-field-hide")}if($(".modal #rs_email").val()==""){$(".modal #rs_email").addClass("required");$(".modal #rs_email_lbl").addClass("required");$(".modal #rs_email_err").addClass("missing-field-show").removeClass("missing-field-hide");$(".modal #rs_email_dup").removeClass("required");n=true}else{$(".modal #rs_email").removeClass("required");$(".modal #rs_email_lbl").removeClass("required");$(".modal #rs_email_err").removeClass("missing-field-show").addClass("missing-field-hide")}if(!n){var m=JSON.stringify({model:"ResponsibleParty",process:"create",data:{name:$(".modal #rs_name").val(),email:$(".modal #rs_email").val(),organization:$(".modal #rs_org").val(),phone:$(".modal #rs_phone").val(),street:$(".modal #rs_street").val(),city:$(".modal #rs_city").val(),state:$(".modal #rs_state").val(),zip:$(".modal #rs_zip").val(),country:$(".modal #rs_country").val()}});$.ajax({url:"/api/action/additional_metadata",type:"POST",data:m,success:function(q){var p={name:$("#rs_name").val(),email:$("#rs_email").val()};var o;if($(k).data("select2").opts.multiple){var s=$(k).data("select2").data();s[s.length-1].id=JSON.stringify(p);s[s.length-1].text=p.name;var t="["+s[0].id;for(var r=1;r<s.length;r++){t+=","+s[r].id}t+="]";$(k).val(t);$(k).trigger("change")}else{$(k).val(JSON.stringify(p));$(k).trigger("change")}j.modal("hide");j.remove()},error:function(q,o,p){$(".modal #rs_email").addClass("required");$(".modal #rs_email_lbl").addClass("required");$(".modal #rs_email_dup").addClass("missing-field-show").removeClass("missing-field-hide")}})}});g.on("click",".btn-cancel",function(m){m.preventDefault();if($(k).data("select2").opts.multiple){var l=$(k).data("select2").data();l.pop();$(k).data("select2").data(l)}else{$(k).data("select2").data("")}j.modal("hide");j.remove()})}}});
